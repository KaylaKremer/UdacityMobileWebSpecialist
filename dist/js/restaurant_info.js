'use strict';

var restaurant = void 0;
var map = void 0;
var liveMap = false;
var initLoad = true;
var offlineReviewCounter = 0;
var offlineFavoriteCounter = 0;

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	fetchRestaurantFromURL(function (error, restaurant) {
		if (error) {
			// Got an error!
			console.error(error, restaurant);
		} else {
			fillBreadcrumb();
		}
	});
};

/**
 * Get current restaurant from page URL.
 */
var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
	if (self.restaurant) {
		// restaurant already fetched!
		callback(null, self.restaurant);
		return;
	}
	var id = getParameterByName('id');
	if (!id) {
		// no id found in URL
		var error = 'No restaurant id in URL';
		callback(error, null);
	} else {
		DBHelper.fetchRestaurantById(id, function (error, restaurant) {
			self.restaurant = restaurant;
			if (!restaurant) {
				console.error(error);
				return;
			}
			fillRestaurantHTML();
			callback(null, restaurant);
		});
	}
};

/**
 * Create restaurant HTML and add it to the webpage
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 16,
			center: restaurant.latlng,
			scrollwheel: false
		});
		addMarkerToMap();
		liveMap = true;
	}
};

var fillRestaurantHTML = function fillRestaurantHTML() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		var staticMap = DBHelper.staticImageForMapRestaurantInfo(self.restaurant);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap(self.restaurant);
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkerToMap();
	}
	var name = document.getElementById('restaurant-name');
	name.innerHTML = restaurant.name;

	createFavoriteButton(restaurant);

	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var image = document.getElementById('restaurant-img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';

	var cuisine = document.getElementById('restaurant-cuisine');
	cuisine.innerHTML = restaurant.cuisine_type;

	var address = document.getElementById('restaurant-address');
	address.innerHTML = restaurant.address;

	// fill operating hours
	if (restaurant.operating_hours) {
		fillRestaurantHoursHTML();
	}
	// fill reviews
	DBHelper.fetchReviewsById(restaurant.id, fillReviewsHTML);
};

/**
 * Creates a favorite button. When clicked, notifies user that restaurant favorite has been added or removed via visual cues and ARIA label changes. Also updates server and IndexedDB with favorite status of the restaurant. If user clicks on favorite button while offline, stores favorite status in local storage and creates an offline label to notify user favorite status will be updated when network connection is reestablished. 
 */
var createFavoriteButton = function createFavoriteButton(restaurant) {
	var favoriteButton = document.getElementById('favorite-button');
	var restaurantId = restaurant.id;
	var isFavorite = restaurant.is_favorite;
	var noOfflineLabel = true;

	changeFavoriteButton(isFavorite, favoriteButton);

	favoriteButton.addEventListener('click', function () {
		if (!navigator.onLine) {
			if (isFavorite === 'false') {
				isFavorite = 'true';
			} else {
				isFavorite = 'false';
			}
			/* Creates unique id to reference favorite status in local storage. */
			offlineFavoriteCounter++;
			var favoriteId = offlineFavoriteCounter.toString();
			/* Make sure only one offline label is created no matter how many times user clicks on favorite button */
			if (noOfflineLabel) {
				var offlineFavoriteLabel = document.createElement('div');
				offlineFavoriteLabel.classList.add('offline-favorite-label');
				offlineFavoriteLabel.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Offline Mode - Favorite status will submit when network connection is reestablished';
				var restaurantHeader = document.getElementById('restaurant-header');
				restaurantHeader.parentNode.insertBefore(offlineFavoriteLabel, restaurantHeader);
				noOfflineLabel = false;
			}
			DBHelper.updateFavorite(favoriteId, restaurantId, isFavorite);
			restaurant.is_favorite = isFavorite;
			changeFavoriteButton(isFavorite, favoriteButton);
			return;
		}

		if (isFavorite === 'false') {
			isFavorite = 'true';
		} else {
			isFavorite = 'false';
		}
		DBHelper.updateFavorite(null, restaurantId, isFavorite);
		restaurant.is_favorite = isFavorite;
		changeFavoriteButton(isFavorite, favoriteButton);
	});
};

/**
 * Change favorite button to appear on or off with class change.
 */
var changeFavoriteButton = function changeFavoriteButton(isFavorite, favoriteButton) {
	if (isFavorite === 'true') {
		favoriteButton.title = 'Remove from favorites';
		favoriteButton.setAttribute('aria-label', 'Remove from favorites');
		favoriteButton.classList.add('restaurant-favorite-true');
		favoriteButton.classList.remove('restaurant-favorite-false');
		favoriteButton.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favoriteButton.title = 'Add to favorites';
		favoriteButton.setAttribute('aria-label', 'Add to favorites');
		favoriteButton.classList.add('restaurant-favorite-false');
		favoriteButton.classList.remove('restaurant-favorite-true');
		favoriteButton.innerHTML = '<i class="far fa-heart"></i>';
	}
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
	var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;

	var hours = document.getElementById('restaurant-hours');
	for (var key in operatingHours) {
		var row = document.createElement('tr');
		var day = document.createElement('td');
		day.innerHTML = key;
		row.appendChild(day);
		var time = document.createElement('td');
		time.innerHTML = operatingHours[key];
		row.appendChild(time);
		hours.appendChild(row);
	}
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
var fillReviewsHTML = function fillReviewsHTML(error, reviews) {
	if (error) {
		console.log(error);
	}
	self.restaurant.reviews = reviews;
	var container = document.getElementById('reviews-container');
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.innerHTML = '';
	if (!reviews) {
		var noReviews = document.createElement('p');
		noReviews.id = 'no-reviews';
		noReviews.innerHTML = 'No reviews yet!';
		container.insertBefore(noReviews, reviewsList);
	} else {
		reviews.forEach(function (review) {
			reviewsList.appendChild(createReviewHTML(review));
		});
		container.appendChild(reviewsList);
	}
};

/**
 * Create review HTML and add it to the webpage.
 */
var createReviewHTML = function createReviewHTML(review) {
	var li = document.createElement('li');

	/* Create label for reviews submitted while offline. */
	if (!navigator.onLine) {
		var offlineReviewLabel = document.createElement('div');
		offlineReviewLabel.classList.add('offline-review-label');
		offlineReviewLabel.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Offline Mode - Review will submit when network connection is reestablished';
		li.appendChild(offlineReviewLabel);
	}

	/* Create delete button to remove reviews */
	var deleteButton = document.createElement('button');
	deleteButton.type = 'button';
	deleteButton.classList.add('delete-button');
	deleteButton.title = 'Delete review';
	deleteButton.setAttribute('aria-label', 'Delete review');
	deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
	li.appendChild(deleteButton);
	deleteButton.addEventListener('click', function (event) {
		event.preventDefault();
		deleteReview(deleteButton, review);
	});

	var name = document.createElement('p');
	name.classList.add('review-header');
	name.innerHTML = review.name;
	li.appendChild(name);

	/* Convert timestamp from epoch time into a more readable format. */
	var timestamp = document.createElement('p');
	timestamp.classList.add('review-header');
	var createdAtTimestamp = new Date(review.createdAt);
	var updatedAtTimestamp = new Date(review.updatedAt);
	if (createdAtTimestamp === updatedAtTimestamp) {
		timestamp.innerHTML = createdAtTimestamp.toLocaleString();
	} else {
		timestamp.innerHTML = updatedAtTimestamp.toLocaleString();
	}
	li.appendChild(timestamp);

	var rating = document.createElement('div');
	rating.classList.add('review-rating');
	if (review.rating > 1) {
		rating.title = review.rating + ' stars';
		rating.setAttribute('aria-label', review.rating + ' stars');
	} else {
		rating.title = review.rating + ' star';
		rating.setAttribute('aria-label', review.rating + ' star');
	}
	rating.innerHTML = review.rating + ' <i class="fas fa-star"></i>';
	li.appendChild(rating);

	var comments = document.createElement('p');
	comments.innerHTML = review.comments;
	li.appendChild(comments);

	return li;
};

/**
 * Add user review to the page, store review data in server & IndexedDB, and reset form. For offline submitted reviews, creates a counter to provide a unique ID number for each offline review saved in local storage.
 */
var submitReview = function submitReview() {
	event.preventDefault();
	offlineReviewCounter++;
	var restaurantId = getParameterByName('id');
	var name = document.getElementById('form-name').value;
	var rating = document.querySelector('#form-rating option:checked').value;
	var comments = document.getElementById('form-comments').value;
	var review = {
		restaurant_id: parseInt(restaurantId),
		name: name,
		createdAt: new Date().getTime(),
		updatedAt: new Date().getTime(),
		rating: parseInt(rating),
		comments: comments,
		offline_id: offlineReviewCounter.toString()
	};
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.appendChild(createReviewHTML(review));
	DBHelper.addReview(review, restaurantId, fillReviewsHTML);
	document.getElementById('form').reset();
	if (!navigator.onLine) {
		console.log('Your review will be submitted when an online connection is reestablished');
	} else {
		console.log('Your review has been submitted!');
	}
};

/**
 * Delete user review from the page and remove review data from server & IndexedDB.
 */
var deleteReview = function deleteReview(deleteButton, review) {
	var reviewToDelete = deleteButton.parentNode;
	var reviewId = review.id;
	var offlineId = review.offline_id;
	var restaurantId = getParameterByName('id');
	DBHelper.removeReview(reviewId, offlineId, restaurantId, fillReviewsHTML);
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.removeChild(reviewToDelete);
};

/**
 * Add restaurant name to the breadcrumb navigation menu
 */
var fillBreadcrumb = function fillBreadcrumb() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	var breadcrumb = document.getElementById('breadcrumb');
	var li = document.createElement('li');
	li.innerHTML = restaurant.name;

	//Set ARIA attributes so screenreader knows its on the current page for the restaurant in the breadcrumb trail.
	li.setAttribute('aria-label', restaurant.name);
	li.setAttribute('aria-describedby', 'breadcrumb-description');
	li.setAttribute('tabindex', '0');

	//Dynamically set title attribute
	li.title = restaurant.name;
	breadcrumb.appendChild(li);
};

/**
 * Get a parameter by name from page URL.
 */
var getParameterByName = function getParameterByName(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, '\\$&');
	var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
	    results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

/**
 * Add marker for current restaurant to the map.
 */
var addMarkerToMap = function addMarkerToMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	// Add marker to the map
	var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
	google.maps.event.addListener(marker, 'click', function () {
		window.location.href = marker.url;
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwibGl2ZU1hcCIsImluaXRMb2FkIiwib2ZmbGluZVJldmlld0NvdW50ZXIiLCJvZmZsaW5lRmF2b3JpdGVDb3VudGVyIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsImNvbnNvbGUiLCJmaWxsQnJlYWRjcnVtYiIsImNhbGxiYWNrIiwic2VsZiIsImlkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiREJIZWxwZXIiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiZ2V0TGl2ZU1hcCIsInN0YXRpY01hcEltZyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiYWRkTWFya2VyVG9NYXAiLCJzdGF0aWNNYXAiLCJzdGF0aWNJbWFnZUZvck1hcFJlc3RhdXJhbnRJbmZvIiwiY3JlYXRlRWxlbWVudCIsImFsdCIsInN0eWxlIiwid2lkdGgiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNyYyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhcHBlbmRDaGlsZCIsIm5hbWUiLCJpbm5lckhUTUwiLCJjcmVhdGVGYXZvcml0ZUJ1dHRvbiIsImltYWdlIiwiY2xhc3NOYW1lIiwic2V0QXR0cmlidXRlIiwic21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudCIsInRpdGxlIiwibmVpZ2hib3Job29kIiwiY3Vpc2luZV90eXBlIiwiY3Vpc2luZSIsImFkZHJlc3MiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZldGNoUmV2aWV3c0J5SWQiLCJmaWxsUmV2aWV3c0hUTUwiLCJmYXZvcml0ZUJ1dHRvbiIsInJlc3RhdXJhbnRJZCIsImlzRmF2b3JpdGUiLCJpc19mYXZvcml0ZSIsIm5vT2ZmbGluZUxhYmVsIiwiY2hhbmdlRmF2b3JpdGVCdXR0b24iLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJmYXZvcml0ZUlkIiwidG9TdHJpbmciLCJvZmZsaW5lRmF2b3JpdGVMYWJlbCIsImNsYXNzTGlzdCIsImFkZCIsInJlc3RhdXJhbnRIZWFkZXIiLCJpbnNlcnRCZWZvcmUiLCJ1cGRhdGVGYXZvcml0ZSIsInJlbW92ZSIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwicmV2aWV3cyIsImxvZyIsImNvbnRhaW5lciIsInJldmlld3NMaXN0Iiwibm9SZXZpZXdzIiwiZm9yRWFjaCIsImNyZWF0ZVJldmlld0hUTUwiLCJyZXZpZXciLCJsaSIsIm9mZmxpbmVSZXZpZXdMYWJlbCIsImRlbGV0ZUJ1dHRvbiIsInR5cGUiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiZGVsZXRlUmV2aWV3IiwidGltZXN0YW1wIiwiY3JlYXRlZEF0VGltZXN0YW1wIiwiRGF0ZSIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdFRpbWVzdGFtcCIsInVwZGF0ZWRBdCIsInRvTG9jYWxlU3RyaW5nIiwicmF0aW5nIiwiY29tbWVudHMiLCJzdWJtaXRSZXZpZXciLCJ2YWx1ZSIsInF1ZXJ5U2VsZWN0b3IiLCJyZXN0YXVyYW50X2lkIiwicGFyc2VJbnQiLCJnZXRUaW1lIiwib2ZmbGluZV9pZCIsImFkZFJldmlldyIsInJlc2V0IiwicmV2aWV3VG9EZWxldGUiLCJyZXZpZXdJZCIsIm9mZmxpbmVJZCIsInJlbW92ZVJldmlldyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVnZXgiLCJSZWdFeHAiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsIm1hcmtlciIsIm1hcE1hcmtlckZv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YSxTQUFiLEVBQXdCLE1BQXhCLENBQVA7QUFDQSxLQUFNQyxRQUFRLElBQUlDLE1BQUosVUFBa0JuRixJQUFsQix1QkFBZDtBQUFBLEtBQ0NvRixVQUFVRixNQUFNRyxJQUFOLENBQVdQLEdBQVgsQ0FEWDtBQUVBLEtBQUksQ0FBQ00sT0FBTCxFQUNDLE9BQU8sSUFBUDtBQUNELEtBQUksQ0FBQ0EsUUFBUSxDQUFSLENBQUwsRUFDQyxPQUFPLEVBQVA7QUFDRCxRQUFPRSxtQkFBbUJGLFFBQVEsQ0FBUixFQUFXSCxPQUFYLENBQW1CLEtBQW5CLEVBQTBCLEdBQTFCLENBQW5CLENBQVA7QUFDQSxDQVhEOztBQWFBOzs7QUFHQSxJQUFNOUYsaUJBQWlCLFNBQWpCQSxjQUFpQixHQUFrQztBQUFBLEtBQWpDaEMsVUFBaUMsdUVBQXBCYSxLQUFLYixVQUFlOztBQUN4RDtBQUNBLEtBQU1vSSxTQUFTcEgsU0FBU3FILHNCQUFULENBQWdDckksVUFBaEMsRUFBNENhLEtBQUtaLEdBQWpELENBQWY7QUFDQXdCLFFBQU9DLElBQVAsQ0FBWXVFLEtBQVosQ0FBa0JxQyxXQUFsQixDQUE4QkYsTUFBOUIsRUFBc0MsT0FBdEMsRUFBK0MsWUFBTTtBQUNwRDlILFNBQU9zSCxRQUFQLENBQWdCQyxJQUFoQixHQUF1Qk8sT0FBT1QsR0FBOUI7QUFDQSxFQUZEO0FBR0EsQ0FORCIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudDtcbmxldCBtYXA7XG5sZXQgbGl2ZU1hcCA9IGZhbHNlO1xubGV0IGluaXRMb2FkID0gdHJ1ZTtcbmxldCBvZmZsaW5lUmV2aWV3Q291bnRlciA9IDA7XG5sZXQgb2ZmbGluZUZhdm9yaXRlQ291bnRlciA9IDA7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcblx0ZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgXG5cdFx0XHQvLyBHb3QgYW4gZXJyb3IhXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yLCByZXN0YXVyYW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0ZmlsbEJyZWFkY3J1bWIoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcblx0aWYgKHNlbGYucmVzdGF1cmFudCkgeyBcblx0XHQvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcblx0XHRjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuXHRcdHJldHVybjtcblx0fVxuXHRjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcblx0aWYgKCFpZCkgeyBcblx0XHQvLyBubyBpZCBmb3VuZCBpbiBVUkxcblx0XHRjb25zdCBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG5cdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHR9IGVsc2Uge1xuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuXHRcdFx0c2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblx0XHRcdGlmICghcmVzdGF1cmFudCkge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0ZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG5cdFx0XHRjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcblx0XHR9KTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuXG4vKiBJZiBhIGxpdmUgbWFwIGlzbid0IGFscmVhZHkgZW5hYmxlZCwgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgcmVwbGFjZXMgaXQgd2l0aCBhIGxpdmUgR29vZ2xlIE1hcC4gKi9cbmNvbnN0IGdldExpdmVNYXAgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuXHRpZihsaXZlTWFwKXtcblx0XHRyZXR1cm47XG5cdH0gZWxzZSB7XG5cdFx0Y29uc3Qgc3RhdGljTWFwSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXRpYy1tYXAtaW1nJyk7XG5cdFx0c3RhdGljTWFwSW1nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc3RhdGljTWFwSW1nKTtcblx0XHRzZWxmLm1hcCA9IG5ldyBnb29nbGVcblx0XHRcdC5tYXBzXG5cdFx0XHQuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuXHRcdFx0XHR6b29tOiAxNixcblx0XHRcdFx0Y2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXG5cdFx0XHR9KTtcblx0XHRhZGRNYXJrZXJUb01hcCgpO1xuXHRcdGxpdmVNYXAgPSB0cnVlO1xuXHR9XG59O1xuXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuXHQvKiBMb2FkcyBhIHN0YXRpYyBtYXAgaW1hZ2UgaWYgaXQncyB0aGUgaW5pdGlhbCBwYWdlIGxvYWQuIEFkZHMgYSBjbGljayBldmVudCBsaXN0ZW5lciBzbyB0aGF0IHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSBtYXAsIGl0IHJlbW92ZXMgdGhlIHN0YXRpYyBtYXAgaW1hZ2UgYW5kIGxvYWRzIGEgbGl2ZSBtYXAgaW4gaXRzIHBsYWNlLiAqL1xuXHRpZiAoaW5pdExvYWQpe1xuXHRcdGNvbnN0IHN0YXRpY01hcCA9IERCSGVscGVyLnN0YXRpY0ltYWdlRm9yTWFwUmVzdGF1cmFudEluZm8oc2VsZi5yZXN0YXVyYW50KTtcblx0XHRjb25zdCBtYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XG5cdFx0Y29uc3Qgc3RhdGljTWFwSW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cdFx0c3RhdGljTWFwSW1nLmlkID0gJ3N0YXRpYy1tYXAtaW1nJztcblx0XHRzdGF0aWNNYXBJbWcuYWx0ID0gJ1N0YXRpYyBHb29nbGUgTWFwcyBpbWFnZSc7XG5cdFx0c3RhdGljTWFwSW1nLnN0eWxlLndpZHRoID0gYCR7bWFwLmNsaWVudFdpZHRofXB4YDtcblx0XHRzdGF0aWNNYXBJbWcuc3R5bGUuaGVpZ2h0ID0gYCR7bWFwLmNsaWVudEhlaWdodH1weGA7XG5cdFx0c3RhdGljTWFwSW1nLnNyYyA9IHN0YXRpY01hcDtcblx0XHRzdGF0aWNNYXBJbWcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0XHRnZXRMaXZlTWFwKHNlbGYucmVzdGF1cmFudCk7XG5cdFx0fSk7XG5cdFx0bWFwLmFwcGVuZENoaWxkKHN0YXRpY01hcEltZyk7XG5cdFx0aW5pdExvYWQgPSBmYWxzZTtcblx0fSBlbHNlIHtcblx0XHRhZGRNYXJrZXJUb01hcCgpO1xuXHR9XG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG5cdGNyZWF0ZUZhdm9yaXRlQnV0dG9uKHJlc3RhdXJhbnQpO1xuXG5cdC8qIExhenkgbG9hZHMgc21hbGwgb3IgbGFyZ2UgdmVyc2lvbiBvZiByZXN0YXVyYW50IGltYWdlIGJhc2VkIG9uIGRhdGEtc3Jjc2V0IGFuZCBhdXRvIGRhdGEtc2l6ZXMuIEFsc28gZHluYW1pY2FsbHkgc2V0cyBhbHQgYW5kIHRpdGxlIHRleHQgb2YgdGhlIGltYWdlLiAqL1xuXHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuXHRpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcgbGF6eWxvYWQnO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgYCR7REJIZWxwZXIuc21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDQwMHdgKTtcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsYCR7REJIZWxwZXIuc21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDQwMHcsICR7REJIZWxwZXIubGFyZ2VJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDgwMHdgKTtcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNpemVzJywgJ2F1dG8nKTtcblx0aW1hZ2UudGl0bGUgPSBgJHtyZXN0YXVyYW50Lm5hbWV9YDtcblx0aW1hZ2UuYWx0ID0gYCR7cmVzdGF1cmFudC5uYW1lfSBpbiAke3Jlc3RhdXJhbnQubmVpZ2hib3Job29kfSAtICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9IHJlc3RhdXJhbnRgO1xuXG5cdGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG5cdGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cblx0Y29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcblx0YWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cblx0Ly8gZmlsbCBvcGVyYXRpbmcgaG91cnNcblx0aWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG5cdFx0ZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcblx0fVxuXHQvLyBmaWxsIHJldmlld3Ncblx0REJIZWxwZXIuZmV0Y2hSZXZpZXdzQnlJZChyZXN0YXVyYW50LmlkLCBmaWxsUmV2aWV3c0hUTUwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgZmF2b3JpdGUgYnV0dG9uLiBXaGVuIGNsaWNrZWQsIG5vdGlmaWVzIHVzZXIgdGhhdCByZXN0YXVyYW50IGZhdm9yaXRlIGhhcyBiZWVuIGFkZGVkIG9yIHJlbW92ZWQgdmlhIHZpc3VhbCBjdWVzIGFuZCBBUklBIGxhYmVsIGNoYW5nZXMuIEFsc28gdXBkYXRlcyBzZXJ2ZXIgYW5kIEluZGV4ZWREQiB3aXRoIGZhdm9yaXRlIHN0YXR1cyBvZiB0aGUgcmVzdGF1cmFudC4gSWYgdXNlciBjbGlja3Mgb24gZmF2b3JpdGUgYnV0dG9uIHdoaWxlIG9mZmxpbmUsIHN0b3JlcyBmYXZvcml0ZSBzdGF0dXMgaW4gbG9jYWwgc3RvcmFnZSBhbmQgY3JlYXRlcyBhbiBvZmZsaW5lIGxhYmVsIHRvIG5vdGlmeSB1c2VyIGZhdm9yaXRlIHN0YXR1cyB3aWxsIGJlIHVwZGF0ZWQgd2hlbiBuZXR3b3JrIGNvbm5lY3Rpb24gaXMgcmVlc3RhYmxpc2hlZC4gXG4gKi9cbmNvbnN0IGNyZWF0ZUZhdm9yaXRlQnV0dG9uID0gKHJlc3RhdXJhbnQpID0+IHtcblx0Y29uc3QgZmF2b3JpdGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmF2b3JpdGUtYnV0dG9uJyk7XG5cdGNvbnN0IHJlc3RhdXJhbnRJZCA9IHJlc3RhdXJhbnQuaWQ7XG5cdGxldCBpc0Zhdm9yaXRlID0gcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcblx0bGV0IG5vT2ZmbGluZUxhYmVsID0gdHJ1ZTtcblxuXHRjaGFuZ2VGYXZvcml0ZUJ1dHRvbihpc0Zhdm9yaXRlLCBmYXZvcml0ZUJ1dHRvbik7XG5cblx0ZmF2b3JpdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xuXHRcdFx0aWYgKGlzRmF2b3JpdGUgPT09ICdmYWxzZScpe1xuXHRcdFx0XHRpc0Zhdm9yaXRlID0gJ3RydWUnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aXNGYXZvcml0ZSA9ICdmYWxzZSc7XG5cdFx0XHR9XG5cdFx0XHQvKiBDcmVhdGVzIHVuaXF1ZSBpZCB0byByZWZlcmVuY2UgZmF2b3JpdGUgc3RhdHVzIGluIGxvY2FsIHN0b3JhZ2UuICovXG5cdFx0XHRvZmZsaW5lRmF2b3JpdGVDb3VudGVyKys7XG5cdFx0XHRsZXQgZmF2b3JpdGVJZCA9IG9mZmxpbmVGYXZvcml0ZUNvdW50ZXIudG9TdHJpbmcoKTtcblx0XHRcdC8qIE1ha2Ugc3VyZSBvbmx5IG9uZSBvZmZsaW5lIGxhYmVsIGlzIGNyZWF0ZWQgbm8gbWF0dGVyIGhvdyBtYW55IHRpbWVzIHVzZXIgY2xpY2tzIG9uIGZhdm9yaXRlIGJ1dHRvbiAqL1xuXHRcdFx0aWYobm9PZmZsaW5lTGFiZWwpe1xuXHRcdFx0XHRjb25zdCBvZmZsaW5lRmF2b3JpdGVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRvZmZsaW5lRmF2b3JpdGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdvZmZsaW5lLWZhdm9yaXRlLWxhYmVsJyk7XG5cdFx0XHRcdG9mZmxpbmVGYXZvcml0ZUxhYmVsLmlubmVySFRNTCA9IGA8aSBjbGFzcz1cImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZVwiPjwvaT4gT2ZmbGluZSBNb2RlIC0gRmF2b3JpdGUgc3RhdHVzIHdpbGwgc3VibWl0IHdoZW4gbmV0d29yayBjb25uZWN0aW9uIGlzIHJlZXN0YWJsaXNoZWRgO1xuXHRcdFx0XHRjb25zdCByZXN0YXVyYW50SGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaGVhZGVyJyk7XG5cdFx0XHRcdHJlc3RhdXJhbnRIZWFkZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUob2ZmbGluZUZhdm9yaXRlTGFiZWwsIHJlc3RhdXJhbnRIZWFkZXIpO1xuXHRcdFx0XHRub09mZmxpbmVMYWJlbCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0REJIZWxwZXIudXBkYXRlRmF2b3JpdGUoZmF2b3JpdGVJZCwgcmVzdGF1cmFudElkLCBpc0Zhdm9yaXRlKTtcblx0XHRcdHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBpc0Zhdm9yaXRlO1xuXHRcdFx0Y2hhbmdlRmF2b3JpdGVCdXR0b24oaXNGYXZvcml0ZSwgZmF2b3JpdGVCdXR0b24pO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmIChpc0Zhdm9yaXRlID09PSAnZmFsc2UnKXtcblx0XHRcdGlzRmF2b3JpdGUgPSAndHJ1ZSc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlzRmF2b3JpdGUgPSAnZmFsc2UnO1xuXHRcdH0gIFxuXHRcdERCSGVscGVyLnVwZGF0ZUZhdm9yaXRlKG51bGwsIHJlc3RhdXJhbnRJZCwgaXNGYXZvcml0ZSk7XG5cdFx0cmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG5cdFx0Y2hhbmdlRmF2b3JpdGVCdXR0b24oaXNGYXZvcml0ZSwgZmF2b3JpdGVCdXR0b24pO1xuXHR9KTtcbn07XG5cbi8qKlxuICogQ2hhbmdlIGZhdm9yaXRlIGJ1dHRvbiB0byBhcHBlYXIgb24gb3Igb2ZmIHdpdGggY2xhc3MgY2hhbmdlLlxuICovXG5jb25zdCBjaGFuZ2VGYXZvcml0ZUJ1dHRvbiA9IChpc0Zhdm9yaXRlLCBmYXZvcml0ZUJ1dHRvbikgPT4ge1xuXHRpZiAoaXNGYXZvcml0ZSA9PT0gJ3RydWUnKXtcblx0XHRmYXZvcml0ZUJ1dHRvbi50aXRsZSA9ICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnO1xuXHRcdGZhdm9yaXRlQnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnKTtcblx0XHRmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdyZXN0YXVyYW50LWZhdm9yaXRlLXRydWUnKTtcblx0XHRmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdyZXN0YXVyYW50LWZhdm9yaXRlLWZhbHNlJyk7XG5cdFx0ZmF2b3JpdGVCdXR0b24uaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFzIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH0gZWxzZSB7XG5cdFx0ZmF2b3JpdGVCdXR0b24udGl0bGUgPSAnQWRkIHRvIGZhdm9yaXRlcyc7XG5cdFx0ZmF2b3JpdGVCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0FkZCB0byBmYXZvcml0ZXMnKTtcblx0XHRmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdyZXN0YXVyYW50LWZhdm9yaXRlLWZhbHNlJyk7XG5cdFx0ZmF2b3JpdGVCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncmVzdGF1cmFudC1mYXZvcml0ZS10cnVlJyk7XG5cdFx0ZmF2b3JpdGVCdXR0b24uaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFyIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG5cdGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcblx0Zm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG5cdFx0Y29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHRjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdGRheS5pbm5lckhUTUwgPSBrZXk7XG5cdFx0cm93LmFwcGVuZENoaWxkKGRheSk7XG5cdFx0Y29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0dGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuXHRcdHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblx0XHRob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJldmlld3NIVE1MID0gKGVycm9yLCByZXZpZXdzKSA9PiB7XG5cdGlmKGVycm9yKXtcblx0XHRjb25zb2xlLmxvZyhlcnJvcik7XG5cdH1cblx0c2VsZi5yZXN0YXVyYW50LnJldmlld3MgPSByZXZpZXdzO1xuXHRjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcblx0Y29uc3QgcmV2aWV3c0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG5cdHJldmlld3NMaXN0LmlubmVySFRNTCA9ICcnO1xuXHRpZiAoIXJldmlld3MpIHtcblx0XHRjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdFx0bm9SZXZpZXdzLmlkID0gJ25vLXJldmlld3MnO1xuXHRcdG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcblx0XHRjb250YWluZXIuaW5zZXJ0QmVmb3JlKG5vUmV2aWV3cywgcmV2aWV3c0xpc3QpO1xuXHR9IGVsc2Uge1xuXHRcdHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuXHRcdFx0cmV2aWV3c0xpc3QuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcblx0XHR9KTtcblx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQocmV2aWV3c0xpc3QpO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBjcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cblx0LyogQ3JlYXRlIGxhYmVsIGZvciByZXZpZXdzIHN1Ym1pdHRlZCB3aGlsZSBvZmZsaW5lLiAqL1xuXHRpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRjb25zdCBvZmZsaW5lUmV2aWV3TGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRvZmZsaW5lUmV2aWV3TGFiZWwuY2xhc3NMaXN0LmFkZCgnb2ZmbGluZS1yZXZpZXctbGFiZWwnKTtcblx0XHRvZmZsaW5lUmV2aWV3TGFiZWwuaW5uZXJIVE1MID0gYDxpIGNsYXNzPVwiZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlXCI+PC9pPiBPZmZsaW5lIE1vZGUgLSBSZXZpZXcgd2lsbCBzdWJtaXQgd2hlbiBuZXR3b3JrIGNvbm5lY3Rpb24gaXMgcmVlc3RhYmxpc2hlZGA7XG5cdFx0bGkuYXBwZW5kQ2hpbGQob2ZmbGluZVJldmlld0xhYmVsKTtcblx0fVxuXG5cdC8qIENyZWF0ZSBkZWxldGUgYnV0dG9uIHRvIHJlbW92ZSByZXZpZXdzICovXG5cdGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRkZWxldGVCdXR0b24udHlwZSA9ICdidXR0b24nO1xuXHRkZWxldGVCdXR0b24uY2xhc3NMaXN0LmFkZCgnZGVsZXRlLWJ1dHRvbicpO1xuXHRkZWxldGVCdXR0b24udGl0bGUgPSAnRGVsZXRlIHJldmlldyc7XG5cdGRlbGV0ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnRGVsZXRlIHJldmlldycpO1xuXHRkZWxldGVCdXR0b24uaW5uZXJIVE1MID0gYDxpIGNsYXNzPVwiZmFzIGZhLXRyYXNoLWFsdFwiPjwvaT5gO1xuXHRsaS5hcHBlbmRDaGlsZChkZWxldGVCdXR0b24pO1xuXHRkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG5cdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRkZWxldGVSZXZpZXcoZGVsZXRlQnV0dG9uLCByZXZpZXcpO1xuXHR9KTtcblxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuYW1lLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1oZWFkZXInKTtcblx0bmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcblx0bGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cblx0LyogQ29udmVydCB0aW1lc3RhbXAgZnJvbSBlcG9jaCB0aW1lIGludG8gYSBtb3JlIHJlYWRhYmxlIGZvcm1hdC4gKi9cblx0Y29uc3QgdGltZXN0YW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHR0aW1lc3RhbXAuY2xhc3NMaXN0LmFkZCgncmV2aWV3LWhlYWRlcicpO1xuXHRjb25zdCBjcmVhdGVkQXRUaW1lc3RhbXAgPSBuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KTtcblx0Y29uc3QgdXBkYXRlZEF0VGltZXN0YW1wID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCk7XG5cdGlmIChjcmVhdGVkQXRUaW1lc3RhbXAgPT09IHVwZGF0ZWRBdFRpbWVzdGFtcCl7XG5cdFx0dGltZXN0YW1wLmlubmVySFRNTCA9IGNyZWF0ZWRBdFRpbWVzdGFtcC50b0xvY2FsZVN0cmluZygpO1xuXHR9IGVsc2Uge1xuXHRcdHRpbWVzdGFtcC5pbm5lckhUTUwgPSB1cGRhdGVkQXRUaW1lc3RhbXAudG9Mb2NhbGVTdHJpbmcoKTtcblx0fVxuXHRsaS5hcHBlbmRDaGlsZCh0aW1lc3RhbXApO1xuXG5cdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRyYXRpbmcuY2xhc3NMaXN0LmFkZCgncmV2aWV3LXJhdGluZycpO1xuXHRpZiAocmV2aWV3LnJhdGluZyA+IDEpe1xuXHRcdHJhdGluZy50aXRsZSA9IGAke3Jldmlldy5yYXRpbmd9IHN0YXJzYDtcblx0XHRyYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LnJhdGluZ30gc3RhcnNgKTtcblx0fSBlbHNlIHtcblx0XHRyYXRpbmcudGl0bGUgPSBgJHtyZXZpZXcucmF0aW5nfSBzdGFyYDtcblx0XHRyYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LnJhdGluZ30gc3RhcmApO1xuXHR9XG5cdHJhdGluZy5pbm5lckhUTUwgPSBgJHtyZXZpZXcucmF0aW5nfSA8aSBjbGFzcz1cImZhcyBmYS1zdGFyXCI+PC9pPmA7XG5cdGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cblx0Y29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcblx0bGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG5cdHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIHVzZXIgcmV2aWV3IHRvIHRoZSBwYWdlLCBzdG9yZSByZXZpZXcgZGF0YSBpbiBzZXJ2ZXIgJiBJbmRleGVkREIsIGFuZCByZXNldCBmb3JtLiBGb3Igb2ZmbGluZSBzdWJtaXR0ZWQgcmV2aWV3cywgY3JlYXRlcyBhIGNvdW50ZXIgdG8gcHJvdmlkZSBhIHVuaXF1ZSBJRCBudW1iZXIgZm9yIGVhY2ggb2ZmbGluZSByZXZpZXcgc2F2ZWQgaW4gbG9jYWwgc3RvcmFnZS5cbiAqL1xuY29uc3Qgc3VibWl0UmV2aWV3ID0gKCkgPT4ge1xuXHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRvZmZsaW5lUmV2aWV3Q291bnRlcisrO1xuXHRjb25zdCByZXN0YXVyYW50SWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybS1uYW1lJykudmFsdWU7XG5cdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmb3JtLXJhdGluZyBvcHRpb246Y2hlY2tlZCcpLnZhbHVlO1xuXHRjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtLWNvbW1lbnRzJykudmFsdWU7XG5cdGNvbnN0IHJldmlldyA9IHtcblx0XHRyZXN0YXVyYW50X2lkOiBwYXJzZUludChyZXN0YXVyYW50SWQpLFxuXHRcdG5hbWU6IG5hbWUsXG5cdFx0Y3JlYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcblx0XHR1cGRhdGVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuXHRcdHJhdGluZzogcGFyc2VJbnQocmF0aW5nKSxcblx0XHRjb21tZW50czogY29tbWVudHMsXG5cdFx0b2ZmbGluZV9pZDogb2ZmbGluZVJldmlld0NvdW50ZXIudG9TdHJpbmcoKSxcblx0fTtcblx0Y29uc3QgcmV2aWV3c0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG5cdHJldmlld3NMaXN0LmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG5cdERCSGVscGVyLmFkZFJldmlldyhyZXZpZXcsIHJlc3RhdXJhbnRJZCwgZmlsbFJldmlld3NIVE1MKTtcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0nKS5yZXNldCgpO1xuXHRpZighbmF2aWdhdG9yLm9uTGluZSl7XG5cdFx0Y29uc29sZS5sb2coJ1lvdXIgcmV2aWV3IHdpbGwgYmUgc3VibWl0dGVkIHdoZW4gYW4gb25saW5lIGNvbm5lY3Rpb24gaXMgcmVlc3RhYmxpc2hlZCcpO1xuXHR9IGVsc2Uge1xuXHRcdGNvbnNvbGUubG9nKCdZb3VyIHJldmlldyBoYXMgYmVlbiBzdWJtaXR0ZWQhJyk7XG5cdH1cbn07XG5cbi8qKlxuICogRGVsZXRlIHVzZXIgcmV2aWV3IGZyb20gdGhlIHBhZ2UgYW5kIHJlbW92ZSByZXZpZXcgZGF0YSBmcm9tIHNlcnZlciAmIEluZGV4ZWREQi5cbiAqL1xuY29uc3QgZGVsZXRlUmV2aWV3ID0gKGRlbGV0ZUJ1dHRvbiwgcmV2aWV3KSA9PiB7XG5cdGNvbnN0IHJldmlld1RvRGVsZXRlID0gZGVsZXRlQnV0dG9uLnBhcmVudE5vZGU7XG5cdGNvbnN0IHJldmlld0lkID0gcmV2aWV3LmlkO1xuXHRjb25zdCBvZmZsaW5lSWQgPSByZXZpZXcub2ZmbGluZV9pZDtcblx0Y29uc3QgcmVzdGF1cmFudElkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXHREQkhlbHBlci5yZW1vdmVSZXZpZXcocmV2aWV3SWQsIG9mZmxpbmVJZCwgcmVzdGF1cmFudElkLCBmaWxsUmV2aWV3c0hUTUwpO1xuXHRjb25zdCByZXZpZXdzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblx0cmV2aWV3c0xpc3QucmVtb3ZlQ2hpbGQocmV2aWV3VG9EZWxldGUpO1xufTtcblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5jb25zdCBmaWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG5cdGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cdGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuXHQvL1NldCBBUklBIGF0dHJpYnV0ZXMgc28gc2NyZWVucmVhZGVyIGtub3dzIGl0cyBvbiB0aGUgY3VycmVudCBwYWdlIGZvciB0aGUgcmVzdGF1cmFudCBpbiB0aGUgYnJlYWRjcnVtYiB0cmFpbC5cblx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmVzdGF1cmFudC5uYW1lKTtcblx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JywgJ2JyZWFkY3J1bWItZGVzY3JpcHRpb24nKTtcblx0bGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cblx0Ly9EeW5hbWljYWxseSBzZXQgdGl0bGUgYXR0cmlidXRlXG5cdGxpLnRpdGxlID0gcmVzdGF1cmFudC5uYW1lO1xuXHRicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuXHRpZiAoIXVybClcblx0XHR1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcblx0bmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuXHRjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcblx0XHRyZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuXHRpZiAoIXJlc3VsdHMpXG5cdFx0cmV0dXJuIG51bGw7XG5cdGlmICghcmVzdWx0c1syXSlcblx0XHRyZXR1cm4gJyc7XG5cdHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59O1xuXG4vKipcbiAqIEFkZCBtYXJrZXIgZm9yIGN1cnJlbnQgcmVzdGF1cmFudCB0byB0aGUgbWFwLlxuICovXG5jb25zdCBhZGRNYXJrZXJUb01hcCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG5cdC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuXHRjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcblx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XG5cdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuXHR9KTtcbn07XG5cbiJdfQ==
