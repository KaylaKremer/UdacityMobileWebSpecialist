"use strict";var restaurant=void 0,map=void 0,liveMap=!1,initLoad=!0,offlineReviewCounter=0,offlineFavoriteCounter=0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e,t):fillBreadcrumb()})};var fetchRestaurantFromURL=function(a){if(self.restaurant)a(null,self.restaurant);else{var e=getParameterByName("id");if(e)DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),a(null,t)):console.error(e)});else{a("No restaurant id in URL",null)}}},getLiveMap=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;if(!liveMap){var t=document.getElementById("static-map-img");t.parentNode.removeChild(t),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),addMarkerToMap(),liveMap=!0}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;if(initLoad){var t=DBHelper.staticImageForMapRestaurantInfo(self.restaurant),a=document.getElementById("map"),n=document.createElement("img");n.id="static-map-img",n.alt="Static Google Maps image",n.style.width=a.clientWidth+"px",n.style.height=a.clientHeight+"px",n.src=t,n.addEventListener("click",function(){getLiveMap(self.restaurant)}),a.appendChild(n),initLoad=!1}else addMarkerToMap();document.getElementById("restaurant-name").innerHTML=e.name,createFavoriteButton(e);var r=document.getElementById("restaurant-img");r.className="restaurant-img lazyload",r.setAttribute("data-src",DBHelper.smallImageUrlForRestaurant(e)+" 400w"),r.setAttribute("data-srcset",DBHelper.smallImageUrlForRestaurant(e)+" 400w, "+DBHelper.largeImageUrlForRestaurant(e)+" 800w"),r.setAttribute("data-sizes","auto"),r.title=""+e.name,r.alt=e.name+" in "+e.neighborhood+" - "+e.cuisine_type+" restaurant",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,document.getElementById("restaurant-address").innerHTML=e.address,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewsById(e.id,fillReviewsHTML)},createFavoriteButton=function(n){var r=document.getElementById("favorite-button"),i=n.id,l=n.is_favorite,o=!0;changeFavoriteButton(l,r),r.addEventListener("click",function(){if(!navigator.onLine){l="false"===l?"true":"false";var e=(++offlineFavoriteCounter).toString();if(o){var t=document.createElement("div");t.classList.add("offline-favorite-label"),t.innerHTML='<i class="fas fa-exclamation-triangle"></i> Offline Mode - Favorite status will submit when network connection is reestablished';var a=document.getElementById("restaurant-header");a.parentNode.insertBefore(t,a),o=!1}return DBHelper.updateFavorite(e,i,l),n.is_favorite=l,void changeFavoriteButton(l,r)}l="false"===l?"true":"false",DBHelper.updateFavorite(null,i,l),n.is_favorite=l,changeFavoriteButton(l,r)})},changeFavoriteButton=function(e,t){"true"===e?(t.title="Remove from favorites",t.setAttribute("aria-label","Remove from favorites"),t.classList.add("restaurant-favorite-true"),t.classList.remove("restaurant-favorite-false"),t.innerHTML='<i class="fas fa-heart"></i>'):(t.title="Add to favorites",t.setAttribute("aria-label","Add to favorites"),t.classList.add("restaurant-favorite-false"),t.classList.remove("restaurant-favorite-true"),t.innerHTML='<i class="far fa-heart"></i>')},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var a in e){var n=document.createElement("tr"),r=document.createElement("td");r.innerHTML=a,n.appendChild(r);var i=document.createElement("td");i.innerHTML=e[a],n.appendChild(i),t.appendChild(n)}},fillReviewsHTML=function(e,t){e&&console.log(e),self.restaurant.reviews=t;var a=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");if(n.innerHTML="",t)t.forEach(function(e){n.appendChild(createReviewHTML(e))}),a.appendChild(n);else{var r=document.createElement("p");r.id="no-reviews",r.innerHTML="No reviews yet!",a.insertBefore(r,n)}},createReviewHTML=function(t){var e=document.createElement("li");if(!navigator.onLine){var a=document.createElement("div");a.classList.add("offline-review-label"),a.innerHTML='<i class="fas fa-exclamation-triangle"></i> Offline Mode - Review will submit when network connection is reestablished',e.appendChild(a)}var n=document.createElement("button");n.type="button",n.classList.add("delete-button"),n.title="Delete review",n.setAttribute("aria-label","Delete review"),n.innerHTML='<i class="fas fa-trash-alt"></i>',e.appendChild(n),n.addEventListener("click",function(e){e.preventDefault(),deleteReview(n,t)});var r=document.createElement("p");r.classList.add("review-header"),r.innerHTML=t.name,e.appendChild(r);var i=document.createElement("p");i.classList.add("review-header");var l=new Date(t.createdAt),o=new Date(t.updatedAt);i.innerHTML=l===o?l.toLocaleString():o.toLocaleString(),e.appendChild(i);var s=document.createElement("div");s.classList.add("review-rating"),1<t.rating?(s.title=t.rating+" stars",s.setAttribute("aria-label",t.rating+" stars")):(s.title=t.rating+" star",s.setAttribute("aria-label",t.rating+" star")),s.innerHTML=t.rating+' <i class="fas fa-star"></i>',e.appendChild(s);var d=document.createElement("p");return d.innerHTML=t.comments,e.appendChild(d),e},submitReview=function(){event.preventDefault(),offlineReviewCounter++;var e=getParameterByName("id"),t=document.getElementById("form-name").value,a=document.querySelector("#form-rating option:checked").value,n=document.getElementById("form-comments").value,r={restaurant_id:parseInt(e),name:t,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),rating:parseInt(a),comments:n,offline_id:offlineReviewCounter.toString()};document.getElementById("reviews-list").appendChild(createReviewHTML(r)),DBHelper.addReview(r,e,fillReviewsHTML),document.getElementById("form").reset(),navigator.onLine?console.log("Your review has been submitted!"):console.log("Your review will be submitted when an online connection is reestablished")},deleteReview=function(e,t){var a=e.parentNode,n=t.id,r=t.offline_id,i=getParameterByName("id");DBHelper.removeReview(n,r,i,fillReviewsHTML),document.getElementById("reviews-list").removeChild(a)},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-label",e.name),a.setAttribute("aria-describedby","breadcrumb-description"),a.setAttribute("tabindex","0"),a.title=e.name,t.appendChild(a)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},addMarkerToMap=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url})};