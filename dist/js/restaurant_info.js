'use strict';

var restaurant = void 0;
var map = void 0;
var liveMap = false;
var initLoad = true;

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	fetchRestaurantFromURL(function (error, restaurant) {
		if (error) {
			// Got an error!
			console.error(error, restaurant);
		} else {
			fillBreadcrumb();
		}
	});
};

/**
 * Get current restaurant from page URL.
 */
var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
	if (self.restaurant) {
		// restaurant already fetched!
		callback(null, self.restaurant);
		return;
	}
	var id = getParameterByName('id');
	if (!id) {
		// no id found in URL
		error = 'No restaurant id in URL';
		callback(error, null);
	} else {
		DBHelper.fetchRestaurantById(id, function (error, restaurant) {
			self.restaurant = restaurant;
			if (!restaurant) {
				console.error(error);
				return;
			}
			fillRestaurantHTML();
			callback(null, restaurant);
		});
	}
};

/**
 * Create restaurant HTML and add it to the webpage
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 16,
			center: self.restaurant.latlng,
			scrollwheel: false
		});
		addMarkerToMap();
		liveMap = true;
	}
};

var fillRestaurantHTML = function fillRestaurantHTML() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		var staticMap = DBHelper.staticImageForMapRestaurantInfo(self.restaurant);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap(self.restaurant);
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkerToMap();
	}
	var name = document.getElementById('restaurant-name');
	name.innerHTML = restaurant.name;

	/* Creates a dynamic favorite button. When clicked, notifies user that restaurant favorite has been added or removed via visual cues and ARIA label changes. Also updates IDB with favorite status of the restaurant. */
	var favorite = document.getElementById('favorite-button');
	getFavoriteClass(restaurant, favorite);
	favorite.addEventListener('click', function () {
		var isFavorite = void 0;
		if (restaurant.is_favorite === 'false') {
			isFavorite = 'true';
			favorite.title = 'Remove from favorites';
			favorite.setAttribute('aria-label', 'Remove from favorites');
		} else {
			isFavorite = 'false';
			favorite.title = 'Add to favorites';
			favorite.setAttribute('aria-label', 'Add to favorites');
		}
		var restaurantId = restaurant.id;
		DBHelper.updateFavorite(restaurantId, isFavorite);
		restaurant.is_favorite = isFavorite;
		getFavoriteClass(restaurant, favorite);
	});

	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var image = document.getElementById('restaurant-img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';

	var cuisine = document.getElementById('restaurant-cuisine');
	cuisine.innerHTML = restaurant.cuisine_type;

	var address = document.getElementById('restaurant-address');
	address.innerHTML = restaurant.address;

	// fill operating hours
	if (restaurant.operating_hours) {
		fillRestaurantHoursHTML();
	}
	// fill reviews
	DBHelper.fetchReviewsById(restaurant.id, fillReviewsHTML);
};

//Create dynamic favorite button
var getFavoriteClass = function getFavoriteClass(restaurant, favorite) {
	if (restaurant.is_favorite === 'true') {
		favorite.classList.add('restaurant-favorite-true');
		favorite.classList.remove('restaurant-favorite-false');
		favorite.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favorite.classList.add('restaurant-favorite-false');
		favorite.classList.remove('restaurant-favorite-true');
		favorite.innerHTML = '<i class="far fa-heart"></i>';
	}
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
	var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;

	var hours = document.getElementById('restaurant-hours');
	for (var key in operatingHours) {
		var row = document.createElement('tr');
		var day = document.createElement('td');
		day.innerHTML = key;
		row.appendChild(day);
		var time = document.createElement('td');
		time.innerHTML = operatingHours[key];
		row.appendChild(time);
		hours.appendChild(row);
	}
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
var fillReviewsHTML = function fillReviewsHTML(error, reviews) {
	if (error) {
		console.log(error);
	}
	self.restaurant.reviews = reviews;
	var container = document.getElementById('reviews-container');
	var ul = document.getElementById('reviews-list');

	var title = document.createElement('h2');
	title.innerHTML = 'Reviews';
	container.insertBefore(title, ul);

	if (!reviews) {
		var noReviews = document.createElement('p');
		noReviews.id = 'no-reviews';
		noReviews.innerHTML = 'No reviews yet!';
		container.insertBefore(noReviews, ul);
	} else {
		reviews.forEach(function (review) {
			ul.appendChild(createReviewHTML(review));
		});
		container.appendChild(ul);
	}
};

/**
 * Create review HTML and add it to the webpage.
 */
var createReviewHTML = function createReviewHTML(review) {
	var li = document.createElement('li');
	var name = document.createElement('p');
	name.classList.add('review-header');
	name.innerHTML = review.name;
	li.appendChild(name);

	var timestamp = document.createElement('p');
	timestamp.classList.add('review-header');
	var createdAtTimestamp = new Date(review.createdAt);
	var updatedAtTimestamp = new Date(review.updatedAt);
	if (createdAtTimestamp === updatedAtTimestamp) {
		timestamp.innerHTML = createdAtTimestamp.toLocaleString();
	} else {
		timestamp.innerHTML = updatedAtTimestamp.toLocaleString();
	}
	li.appendChild(timestamp);

	var rating = document.createElement('div');
	rating.classList.add('review-rating');
	if (review.rating > 1) {
		rating.title = review.rating + ' stars';
		rating.setAttribute('aria-label', review.rating + ' stars');
	} else {
		rating.title = review.rating + ' star';
		rating.setAttribute('aria-label', review.rating + ' star');
	}
	rating.innerHTML = review.rating + ' <i class="fas fa-star"></i>';
	li.appendChild(rating);

	var comments = document.createElement('p');
	comments.innerHTML = review.comments;
	li.appendChild(comments);

	return li;
};

/**
 * Add restaurant name to the breadcrumb navigation menu
 */
var fillBreadcrumb = function fillBreadcrumb() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	var breadcrumb = document.getElementById('breadcrumb');
	var li = document.createElement('li');
	li.innerHTML = restaurant.name;

	//Set ARIA attributes so screenreader knows its on the current page for the restaurant in the breadcrumb trail.
	li.setAttribute('aria-label', restaurant.name);
	li.setAttribute('aria-describedby', 'breadcrumb-description');
	li.setAttribute('tabindex', '0');

	//Dynamically set title attribute
	li.title = restaurant.name;
	breadcrumb.appendChild(li);
};

/**
 * Get a parameter by name from page URL.
 */
var getParameterByName = function getParameterByName(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, '\\$&');
	var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
	    results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

/**
 * Add marker for current restaurant to the map.
 */
var addMarkerToMap = function addMarkerToMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	// Add marker to the map
	var marker = DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);
	google.maps.event.addListener(marker, 'click', function () {
		window.location.href = marker.url;
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwibGl2ZU1hcCIsImluaXRMb2FkIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsImNvbnNvbGUiLCJmaWxsQnJlYWRjcnVtYiIsImNhbGxiYWNrIiwic2VsZiIsImlkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiREJIZWxwZXIiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiZ2V0TGl2ZU1hcCIsInN0YXRpY01hcEltZyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiYWRkTWFya2VyVG9NYXAiLCJzdGF0aWNNYXAiLCJzdGF0aWNJbWFnZUZvck1hcFJlc3RhdXJhbnRJbmZvIiwiY3JlYXRlRWxlbWVudCIsImFsdCIsInN0eWxlIiwid2lkdGgiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNyYyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhcHBlbmRDaGlsZCIsIm5hbWUiLCJpbm5lckhUTUwiLCJmYXZvcml0ZSIsImdldEZhdm9yaXRlQ2xhc3MiLCJpc0Zhdm9yaXRlIiwiaXNfZmF2b3JpdGUiLCJ0aXRsZSIsInNldEF0dHJpYnV0ZSIsInJlc3RhdXJhbnRJZCIsInVwZGF0ZUZhdm9yaXRlIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudCIsImxhcmdlSW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwibmVpZ2hib3Job29kIiwiY3Vpc2luZV90eXBlIiwiY3Vpc2luZSIsImFkZHJlc3MiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZldGNoUmV2aWV3c0J5SWQiLCJmaWxsUmV2aWV3c0hUTUwiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwidGltZSIsInJldmlld3MiLCJsb2ciLCJjb250YWluZXIiLCJ1bCIsImluc2VydEJlZm9yZSIsIm5vUmV2aWV3cyIsImZvckVhY2giLCJjcmVhdGVSZXZpZXdIVE1MIiwicmV2aWV3IiwibGkiLCJ0aW1lc3RhbXAiLCJjcmVhdGVkQXRUaW1lc3RhbXAiLCJEYXRlIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0VGltZXN0YW1wIiwidXBkYXRlZEF0IiwidG9Mb2NhbGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVnZXgiLCJSZWdFeHAiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJldmVudCIsImFkZExpc3RlbmVyIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLG1CQUFKO0FBQ0EsSUFBSUMsWUFBSjtBQUNBLElBQUlDLFVBQVUsS0FBZDtBQUNBLElBQUlDLFdBQVcsSUFBZjs7QUFFQTs7O0FBR0FDLE9BQU9DLE9BQVAsR0FBaUIsWUFBTTtBQUN0QkMsd0JBQXVCLFVBQUNDLEtBQUQsRUFBUVAsVUFBUixFQUF1QjtBQUM3QyxNQUFJTyxLQUFKLEVBQVc7QUFDVjtBQUNBQyxXQUFRRCxLQUFSLENBQWNBLEtBQWQsRUFBcUJQLFVBQXJCO0FBQ0EsR0FIRCxNQUdPO0FBQ05TO0FBQ0E7QUFDRCxFQVBEO0FBUUEsQ0FURDs7QUFXQTs7O0FBR0EsSUFBTUgseUJBQXlCLFNBQXpCQSxzQkFBeUIsQ0FBQ0ksUUFBRCxFQUFjO0FBQzVDLEtBQUlDLEtBQUtYLFVBQVQsRUFBcUI7QUFDcEI7QUFDQVUsV0FBUyxJQUFULEVBQWVDLEtBQUtYLFVBQXBC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T0FBTyxJQUFQO0FBQ0QsS0FBSSxDQUFDQSxRQUFRLENBQVIsQ0FBTCxFQUNDLE9BQU8sRUFBUDtBQUNELFFBQU9FLG1CQUFtQkYsUUFBUSxDQUFSLEVBQVdILE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNBLENBWEQ7O0FBYUE7OztBQUdBLElBQU1uRSxpQkFBaUIsU0FBakJBLGNBQWlCLEdBQWtDO0FBQUEsS0FBakM5QixVQUFpQyx1RUFBcEJXLEtBQUtYLFVBQWU7O0FBQ3hEO0FBQ0EsS0FBTXVHLFNBQVN6RixTQUFTMEYsc0JBQVQsQ0FBZ0M3RixLQUFLWCxVQUFyQyxFQUFpRFcsS0FBS1YsR0FBdEQsQ0FBZjtBQUNBc0IsUUFBT0MsSUFBUCxDQUFZaUYsS0FBWixDQUFrQkMsV0FBbEIsQ0FBOEJILE1BQTlCLEVBQXNDLE9BQXRDLEVBQStDLFlBQU07QUFDcERuRyxTQUFPMkYsUUFBUCxDQUFnQkMsSUFBaEIsR0FBdUJPLE9BQU9ULEdBQTlCO0FBQ0EsRUFGRDtBQUdBLENBTkQiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XG5sZXQgbWFwO1xubGV0IGxpdmVNYXAgPSBmYWxzZTtcbmxldCBpbml0TG9hZCA9IHRydWU7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcblx0ZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgXG5cdFx0XHQvLyBHb3QgYW4gZXJyb3IhXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yLCByZXN0YXVyYW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0ZmlsbEJyZWFkY3J1bWIoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcblx0aWYgKHNlbGYucmVzdGF1cmFudCkgeyBcblx0XHQvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcblx0XHRjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuXHRcdHJldHVybjtcblx0fVxuXHRjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcblx0aWYgKCFpZCkgeyBcblx0XHQvLyBubyBpZCBmb3VuZCBpbiBVUkxcblx0XHRlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG5cdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHR9IGVsc2Uge1xuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuXHRcdFx0c2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblx0XHRcdGlmICghcmVzdGF1cmFudCkge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0ZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG5cdFx0XHRjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcblx0XHR9KTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuXG4vKiBJZiBhIGxpdmUgbWFwIGlzbid0IGFscmVhZHkgZW5hYmxlZCwgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgcmVwbGFjZXMgaXQgd2l0aCBhIGxpdmUgR29vZ2xlIE1hcC4gKi9cbmNvbnN0IGdldExpdmVNYXAgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuXHRpZihsaXZlTWFwKXtcblx0XHRyZXR1cm47XG5cdH0gZWxzZSB7XG5cdFx0Y29uc3Qgc3RhdGljTWFwSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXRpYy1tYXAtaW1nJyk7XG5cdFx0c3RhdGljTWFwSW1nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc3RhdGljTWFwSW1nKTtcblx0XHRzZWxmLm1hcCA9IG5ldyBnb29nbGVcblx0XHRcdC5tYXBzXG5cdFx0XHQuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuXHRcdFx0XHR6b29tOiAxNixcblx0XHRcdFx0Y2VudGVyOiBzZWxmLnJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0XHRzY3JvbGx3aGVlbDogZmFsc2Vcblx0XHRcdH0pO1xuXHRcdGFkZE1hcmtlclRvTWFwKCk7XG5cdFx0bGl2ZU1hcCA9IHRydWU7XG5cdH1cbn07XG5cbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG5cdC8qIExvYWRzIGEgc3RhdGljIG1hcCBpbWFnZSBpZiBpdCdzIHRoZSBpbml0aWFsIHBhZ2UgbG9hZC4gQWRkcyBhIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHNvIHRoYXQgd2hlbiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIG1hcCwgaXQgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgbG9hZHMgYSBsaXZlIG1hcCBpbiBpdHMgcGxhY2UuICovXG5cdGlmIChpbml0TG9hZCl7XG5cdFx0Y29uc3Qgc3RhdGljTWFwID0gREJIZWxwZXIuc3RhdGljSW1hZ2VGb3JNYXBSZXN0YXVyYW50SW5mbyhzZWxmLnJlc3RhdXJhbnQpO1xuXHRcdGNvbnN0IG1hcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblx0XHRjb25zdCBzdGF0aWNNYXBJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0XHRzdGF0aWNNYXBJbWcuaWQgPSAnc3RhdGljLW1hcC1pbWcnO1xuXHRcdHN0YXRpY01hcEltZy5hbHQgPSAnU3RhdGljIEdvb2dsZSBNYXBzIGltYWdlJztcblx0XHRzdGF0aWNNYXBJbWcuc3R5bGUud2lkdGggPSBgJHttYXAuY2xpZW50V2lkdGh9cHhgO1xuXHRcdHN0YXRpY01hcEltZy5zdHlsZS5oZWlnaHQgPSBgJHttYXAuY2xpZW50SGVpZ2h0fXB4YDtcblx0XHRzdGF0aWNNYXBJbWcuc3JjID0gc3RhdGljTWFwO1xuXHRcdHN0YXRpY01hcEltZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRcdGdldExpdmVNYXAoc2VsZi5yZXN0YXVyYW50KTtcblx0XHR9KTtcblx0XHRtYXAuYXBwZW5kQ2hpbGQoc3RhdGljTWFwSW1nKTtcblx0XHRpbml0TG9hZCA9IGZhbHNlO1xuXHR9IGVsc2Uge1xuXHRcdGFkZE1hcmtlclRvTWFwKCk7XG5cdH1cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcblx0bmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cblx0LyogQ3JlYXRlcyBhIGR5bmFtaWMgZmF2b3JpdGUgYnV0dG9uLiBXaGVuIGNsaWNrZWQsIG5vdGlmaWVzIHVzZXIgdGhhdCByZXN0YXVyYW50IGZhdm9yaXRlIGhhcyBiZWVuIGFkZGVkIG9yIHJlbW92ZWQgdmlhIHZpc3VhbCBjdWVzIGFuZCBBUklBIGxhYmVsIGNoYW5nZXMuIEFsc28gdXBkYXRlcyBJREIgd2l0aCBmYXZvcml0ZSBzdGF0dXMgb2YgdGhlIHJlc3RhdXJhbnQuICovXG5cdGNvbnN0IGZhdm9yaXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zhdm9yaXRlLWJ1dHRvbicpO1xuXHRnZXRGYXZvcml0ZUNsYXNzKHJlc3RhdXJhbnQsIGZhdm9yaXRlKTtcblx0ZmF2b3JpdGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0bGV0IGlzRmF2b3JpdGU7XG5cdFx0aWYocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ2ZhbHNlJyl7XG5cdFx0XHRpc0Zhdm9yaXRlID0gJ3RydWUnO1xuXHRcdFx0ZmF2b3JpdGUudGl0bGUgPSAnUmVtb3ZlIGZyb20gZmF2b3JpdGVzJztcblx0XHRcdGZhdm9yaXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aXNGYXZvcml0ZSA9ICdmYWxzZSc7XG5cdFx0XHRmYXZvcml0ZS50aXRsZSA9ICdBZGQgdG8gZmF2b3JpdGVzJztcblx0XHRcdGZhdm9yaXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdBZGQgdG8gZmF2b3JpdGVzJyk7XG5cdFx0fVxuXHRcdGNvbnN0IHJlc3RhdXJhbnRJZCA9IHJlc3RhdXJhbnQuaWQ7XG5cdFx0REJIZWxwZXIudXBkYXRlRmF2b3JpdGUocmVzdGF1cmFudElkLCBpc0Zhdm9yaXRlKTtcblx0XHRyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gaXNGYXZvcml0ZTtcblx0XHRnZXRGYXZvcml0ZUNsYXNzKHJlc3RhdXJhbnQsIGZhdm9yaXRlKTtcblx0fSk7XG5cblx0LyogTGF6eSBsb2FkcyBzbWFsbCBvciBsYXJnZSB2ZXJzaW9uIG9mIHJlc3RhdXJhbnQgaW1hZ2UgYmFzZWQgb24gZGF0YS1zcmNzZXQgYW5kIGF1dG8gZGF0YS1zaXplcy4gQWxzbyBkeW5hbWljYWxseSBzZXRzIGFsdCBhbmQgdGl0bGUgdGV4dCBvZiB0aGUgaW1hZ2UuICovXG5cdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyBsYXp5bG9hZCc7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBgJHtEQkhlbHBlci5zbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gNDAwd2ApO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JyxgJHtEQkhlbHBlci5zbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gNDAwdywgJHtEQkhlbHBlci5sYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gODAwd2ApO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2l6ZXMnLCAnYXV0bycpO1xuXHRpbWFnZS50aXRsZSA9IGAke3Jlc3RhdXJhbnQubmFtZX1gO1xuXHRpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IGluICR7cmVzdGF1cmFudC5uZWlnaGJvcmhvb2R9IC0gJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gcmVzdGF1cmFudGA7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcblx0Y3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuXHQvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuXHRpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcblx0XHRmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuXHR9XG5cdC8vIGZpbGwgcmV2aWV3c1xuXHREQkhlbHBlci5mZXRjaFJldmlld3NCeUlkKHJlc3RhdXJhbnQuaWQsIGZpbGxSZXZpZXdzSFRNTCk7XG59O1xuXG4vL0NyZWF0ZSBkeW5hbWljIGZhdm9yaXRlIGJ1dHRvblxuY29uc3QgZ2V0RmF2b3JpdGVDbGFzcyA9IChyZXN0YXVyYW50LCBmYXZvcml0ZSkgPT4ge1xuXHRpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnKXtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdyZXN0YXVyYW50LWZhdm9yaXRlLXRydWUnKTtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QucmVtb3ZlKCdyZXN0YXVyYW50LWZhdm9yaXRlLWZhbHNlJyk7XG5cdFx0ZmF2b3JpdGUuaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFzIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH0gZWxzZSB7XG5cdFx0ZmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgncmVzdGF1cmFudC1mYXZvcml0ZS1mYWxzZScpO1xuXHRcdGZhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ3Jlc3RhdXJhbnQtZmF2b3JpdGUtdHJ1ZScpO1xuXHRcdGZhdm9yaXRlLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhciBmYS1oZWFydFwiPjwvaT4nO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuXHRjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG5cdGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuXHRcdGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cdFx0Y29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHRkYXkuaW5uZXJIVE1MID0ga2V5O1xuXHRcdHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXHRcdGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcblx0XHRyb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cdFx0aG91cnMuYXBwZW5kQ2hpbGQocm93KTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChlcnJvciwgcmV2aWV3cykgPT4ge1xuXHRpZihlcnJvcil7XG5cdFx0Y29uc29sZS5sb2coZXJyb3IpO1xuXHR9XG5cdHNlbGYucmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuXG5cdGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcblx0dGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuXHRjb250YWluZXIuaW5zZXJ0QmVmb3JlKHRpdGxlLCB1bCk7XG5cblx0aWYgKCFyZXZpZXdzKSB7XG5cdFx0Y29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdG5vUmV2aWV3cy5pZCA9ICduby1yZXZpZXdzJztcblx0XHRub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG5cdFx0Y29udGFpbmVyLmluc2VydEJlZm9yZShub1Jldmlld3MsIHVsKTtcblx0fSBlbHNlIHtcblx0XHRyZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcblx0XHRcdHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG5cdFx0fSk7XG5cdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuYW1lLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1oZWFkZXInKTtcblx0bmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcblx0bGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cblx0Y29uc3QgdGltZXN0YW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHR0aW1lc3RhbXAuY2xhc3NMaXN0LmFkZCgncmV2aWV3LWhlYWRlcicpO1xuXHRjb25zdCBjcmVhdGVkQXRUaW1lc3RhbXAgPSBuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KTtcblx0Y29uc3QgdXBkYXRlZEF0VGltZXN0YW1wID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCk7XG5cdGlmIChjcmVhdGVkQXRUaW1lc3RhbXAgPT09IHVwZGF0ZWRBdFRpbWVzdGFtcCl7XG5cdFx0dGltZXN0YW1wLmlubmVySFRNTCA9IGNyZWF0ZWRBdFRpbWVzdGFtcC50b0xvY2FsZVN0cmluZygpO1xuXHR9IGVsc2Uge1xuXHRcdHRpbWVzdGFtcC5pbm5lckhUTUwgPSB1cGRhdGVkQXRUaW1lc3RhbXAudG9Mb2NhbGVTdHJpbmcoKTtcblx0fVxuXHRsaS5hcHBlbmRDaGlsZCh0aW1lc3RhbXApO1xuXG5cdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRyYXRpbmcuY2xhc3NMaXN0LmFkZCgncmV2aWV3LXJhdGluZycpO1xuXHRpZiAocmV2aWV3LnJhdGluZyA+IDEpe1xuXHRcdHJhdGluZy50aXRsZSA9IGAke3Jldmlldy5yYXRpbmd9IHN0YXJzYDtcblx0XHRyYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LnJhdGluZ30gc3RhcnNgKTtcblx0fSBlbHNlIHtcblx0XHRyYXRpbmcudGl0bGUgPSBgJHtyZXZpZXcucmF0aW5nfSBzdGFyYDtcblx0XHRyYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LnJhdGluZ30gc3RhcmApO1xuXHR9XG5cdHJhdGluZy5pbm5lckhUTUwgPSBgJHtyZXZpZXcucmF0aW5nfSA8aSBjbGFzcz1cImZhcyBmYS1zdGFyXCI+PC9pPmA7XG5cdGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cblx0Y29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcblx0bGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG5cdHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcblx0Y29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblx0bGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG5cdC8vU2V0IEFSSUEgYXR0cmlidXRlcyBzbyBzY3JlZW5yZWFkZXIga25vd3MgaXRzIG9uIHRoZSBjdXJyZW50IHBhZ2UgZm9yIHRoZSByZXN0YXVyYW50IGluIHRoZSBicmVhZGNydW1iIHRyYWlsLlxuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByZXN0YXVyYW50Lm5hbWUpO1xuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAnYnJlYWRjcnVtYi1kZXNjcmlwdGlvbicpO1xuXHRsaS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcblxuXHQvL0R5bmFtaWNhbGx5IHNldCB0aXRsZSBhdHRyaWJ1dGVcblx0bGkudGl0bGUgPSByZXN0YXVyYW50Lm5hbWU7XG5cdGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufTtcblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBnZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG5cdGlmICghdXJsKVxuXHRcdHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuXHRuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG5cdGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuXHRcdHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG5cdGlmICghcmVzdWx0cylcblx0XHRyZXR1cm4gbnVsbDtcblx0aWYgKCFyZXN1bHRzWzJdKVxuXHRcdHJldHVybiAnJztcblx0cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cbi8qKlxuICogQWRkIG1hcmtlciBmb3IgY3VycmVudCByZXN0YXVyYW50IHRvIHRoZSBtYXAuXG4gKi9cbmNvbnN0IGFkZE1hcmtlclRvTWFwID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcblx0Ly8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG5cdGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuXHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcblx0fSk7XG59OyJdfQ==
