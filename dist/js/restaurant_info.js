'use strict';

var restaurant = void 0;
var map = void 0;
var liveMap = false;
var initLoad = true;
var offlineReviewCounter = 0;
var offlineFavoriteCounter = 0;

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	fetchRestaurantFromURL(function (error, restaurant) {
		if (error) {
			// Got an error!
			console.error(error, restaurant);
		} else {
			fillBreadcrumb();
		}
	});
};

/**
 * Get current restaurant from page URL.
 */
var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
	if (self.restaurant) {
		// restaurant already fetched!
		callback(null, self.restaurant);
		return;
	}
	var id = getParameterByName('id');
	if (!id) {
		// no id found in URL
		var error = 'No restaurant id in URL';
		callback(error, null);
	} else {
		DBHelper.fetchRestaurantById(id, function (error, restaurant) {
			self.restaurant = restaurant;
			if (!restaurant) {
				console.error(error);
				return;
			}
			fillRestaurantHTML();
			callback(null, restaurant);
		});
	}
};

/**
 * Create restaurant HTML and add it to the webpage
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 16,
			center: restaurant.latlng,
			scrollwheel: false
		});
		addMarkerToMap();
		liveMap = true;
	}
};

var fillRestaurantHTML = function fillRestaurantHTML() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		var staticMap = DBHelper.staticImageForMapRestaurantInfo(self.restaurant);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap(self.restaurant);
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkerToMap();
	}
	var name = document.getElementById('restaurant-name');
	name.innerHTML = restaurant.name;

	createFavoriteButton(restaurant);

	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var image = document.getElementById('restaurant-img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';

	var cuisine = document.getElementById('restaurant-cuisine');
	cuisine.innerHTML = restaurant.cuisine_type;

	var address = document.getElementById('restaurant-address');
	address.innerHTML = restaurant.address;

	// fill operating hours
	if (restaurant.operating_hours) {
		fillRestaurantHoursHTML();
	}
	// fill reviews
	DBHelper.fetchReviewsById(restaurant.id, fillReviewsHTML);
};

/**
 * Creates a favorite button. When clicked, notifies user that restaurant favorite has been added or removed via visual cues and ARIA label changes. Also updates server and IndexedDB with favorite status of the restaurant. If user clicks on favorite button while offline, stores favorite status in local storage and creates an offline label to notify user favorite status will be updated when network connection is reestablished. 
 */
var createFavoriteButton = function createFavoriteButton(restaurant) {
	var favorite = document.getElementById('favorite-button');
	getFavoriteButtonClass(restaurant, favorite);

	favorite.addEventListener('click', function () {
		var restaurantId = restaurant.id;
		var isFavorite = void 0;

		if (restaurant.is_favorite === 'false') {
			isFavorite = 'true';
			favorite.title = 'Remove from favorites';
			favorite.setAttribute('aria-label', 'Remove from favorites');
		} else {
			isFavorite = 'false';
			favorite.title = 'Add to favorites';
			favorite.setAttribute('aria-label', 'Add to favorites');
		}

		if (!navigator.onLine) {
			/* Creates unique id to reference favorite status in local storage. */
			offlineFavoriteCounter++;
			var favoriteId = offlineFavoriteCounter.toString();
			/* Make sure only one offline label is created no matter how many times user clicks on favorite button */
			if (!document.querySelector('.offline-favorite-label')) {
				var offlineFavoriteLabel = document.createElement('div');
				offlineFavoriteLabel.classList.add('offline-favorite-label');
				offlineFavoriteLabel.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Offline Mode - Favorite status will submit when network connection is reestablished';
				var restaurantHeader = document.getElementById('restaurant-header');
				restaurantHeader.parentNode.insertBefore(offlineFavoriteLabel, restaurantHeader);
			}
			DBHelper.updateFavorite(favoriteId, restaurantId, isFavorite);
			restaurant.is_favorite = isFavorite;
			getFavoriteButtonClass(restaurant, favorite);
			return;
		}
		DBHelper.updateFavorite(null, restaurantId, isFavorite);
		restaurant.is_favorite = isFavorite;
		getFavoriteButtonClass(restaurant, favorite);
	});
};

/**
 * Change favorite button to appear on or off with class change.
 */
var getFavoriteButtonClass = function getFavoriteButtonClass(restaurant, favorite) {
	if (restaurant.is_favorite === 'true') {
		favorite.classList.add('restaurant-favorite-true');
		favorite.classList.remove('restaurant-favorite-false');
		favorite.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favorite.classList.add('restaurant-favorite-false');
		favorite.classList.remove('restaurant-favorite-true');
		favorite.innerHTML = '<i class="far fa-heart"></i>';
	}
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
	var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;

	var hours = document.getElementById('restaurant-hours');
	for (var key in operatingHours) {
		var row = document.createElement('tr');
		var day = document.createElement('td');
		day.innerHTML = key;
		row.appendChild(day);
		var time = document.createElement('td');
		time.innerHTML = operatingHours[key];
		row.appendChild(time);
		hours.appendChild(row);
	}
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
var fillReviewsHTML = function fillReviewsHTML(error, reviews) {
	if (error) {
		console.log(error);
	}
	self.restaurant.reviews = reviews;
	var container = document.getElementById('reviews-container');
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.innerHTML = '';
	if (!reviews) {
		var noReviews = document.createElement('p');
		noReviews.id = 'no-reviews';
		noReviews.innerHTML = 'No reviews yet!';
		container.insertBefore(noReviews, reviewsList);
	} else {
		reviews.forEach(function (review) {
			reviewsList.appendChild(createReviewHTML(review));
		});
		container.appendChild(reviewsList);
	}
};

/**
 * Create review HTML and add it to the webpage.
 */
var createReviewHTML = function createReviewHTML(review) {
	var li = document.createElement('li');

	/* Create label for reviews submitted while offline. */
	if (!navigator.onLine) {
		var offlineReviewLabel = document.createElement('div');
		offlineReviewLabel.classList.add('offline-review-label');
		offlineReviewLabel.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Offline Mode - Review will submit when network connection is reestablished';
		li.appendChild(offlineReviewLabel);
	}

	/* Create delete button to remove reviews */
	var deleteButton = document.createElement('button');
	deleteButton.type = 'button';
	deleteButton.classList.add('delete-button');
	deleteButton.title = 'Delete review';
	deleteButton.setAttribute('aria-label', 'Delete review');
	deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
	li.appendChild(deleteButton);
	deleteButton.addEventListener('click', function (event) {
		event.preventDefault();
		deleteReview(deleteButton, review);
	});

	var name = document.createElement('p');
	name.classList.add('review-header');
	name.innerHTML = review.name;
	li.appendChild(name);

	/* Convert timestamp from epoch time into a more readable format. */
	var timestamp = document.createElement('p');
	timestamp.classList.add('review-header');
	var createdAtTimestamp = new Date(review.createdAt);
	var updatedAtTimestamp = new Date(review.updatedAt);
	if (createdAtTimestamp === updatedAtTimestamp) {
		timestamp.innerHTML = createdAtTimestamp.toLocaleString();
	} else {
		timestamp.innerHTML = updatedAtTimestamp.toLocaleString();
	}
	li.appendChild(timestamp);

	var rating = document.createElement('div');
	rating.classList.add('review-rating');
	if (review.rating > 1) {
		rating.title = review.rating + ' stars';
		rating.setAttribute('aria-label', review.rating + ' stars');
	} else {
		rating.title = review.rating + ' star';
		rating.setAttribute('aria-label', review.rating + ' star');
	}
	rating.innerHTML = review.rating + ' <i class="fas fa-star"></i>';
	li.appendChild(rating);

	var comments = document.createElement('p');
	comments.innerHTML = review.comments;
	li.appendChild(comments);

	return li;
};

/**
 * Add user review to the page, store review data in server & IndexedDB, and reset form. For offline submitted reviews, creates a counter to provide a unique ID number for each offline review saved in local storage.
 */
var submitReview = function submitReview() {
	event.preventDefault();
	offlineReviewCounter++;
	var restaurantId = getParameterByName('id');
	var name = document.getElementById('form-name').value;
	var rating = document.querySelector('#form-rating option:checked').value;
	var comments = document.getElementById('form-comments').value;
	var review = {
		restaurant_id: parseInt(restaurantId),
		name: name,
		createdAt: new Date().getTime(),
		updatedAt: new Date().getTime(),
		rating: parseInt(rating),
		comments: comments,
		offline_id: offlineReviewCounter.toString()
	};
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.appendChild(createReviewHTML(review));
	DBHelper.addReview(review, restaurantId, fillReviewsHTML);
	document.getElementById('form').reset();
	if (!navigator.onLine) {
		console.log('Your review will be submitted when an online connection is reestablished');
	} else {
		console.log('Your review has been submitted!');
	}
};

/**
 * Delete user review from the page and remove review data from server & IndexedDB.
 */
var deleteReview = function deleteReview(deleteButton, review) {
	var reviewToDelete = deleteButton.parentNode;
	var reviewId = review.id;
	var offlineId = review.offline_id;
	var restaurantId = getParameterByName('id');
	DBHelper.removeReview(reviewId, offlineId, restaurantId, fillReviewsHTML);
	var reviewsList = document.getElementById('reviews-list');
	reviewsList.removeChild(reviewToDelete);
};

/**
 * Add restaurant name to the breadcrumb navigation menu
 */
var fillBreadcrumb = function fillBreadcrumb() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	var breadcrumb = document.getElementById('breadcrumb');
	var li = document.createElement('li');
	li.innerHTML = restaurant.name;

	//Set ARIA attributes so screenreader knows its on the current page for the restaurant in the breadcrumb trail.
	li.setAttribute('aria-label', restaurant.name);
	li.setAttribute('aria-describedby', 'breadcrumb-description');
	li.setAttribute('tabindex', '0');

	//Dynamically set title attribute
	li.title = restaurant.name;
	breadcrumb.appendChild(li);
};

/**
 * Get a parameter by name from page URL.
 */
var getParameterByName = function getParameterByName(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, '\\$&');
	var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
	    results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

/**
 * Add marker for current restaurant to the map.
 */
var addMarkerToMap = function addMarkerToMap() {
	var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;

	// Add marker to the map
	var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
	google.maps.event.addListener(marker, 'click', function () {
		window.location.href = marker.url;
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwibGl2ZU1hcCIsImluaXRMb2FkIiwib2ZmbGluZVJldmlld0NvdW50ZXIiLCJvZmZsaW5lRmF2b3JpdGVDb3VudGVyIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsImNvbnNvbGUiLCJmaWxsQnJlYWRjcnVtYiIsImNhbGxiYWNrIiwic2VsZiIsImlkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiREJIZWxwZXIiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiZ2V0TGl2ZU1hcCIsInN0YXRpY01hcEltZyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiYWRkTWFya2VyVG9NYXAiLCJzdGF0aWNNYXAiLCJzdGF0aWNJbWFnZUZvck1hcFJlc3RhdXJhbnRJbmZvIiwiY3JlYXRlRWxlbWVudCIsImFsdCIsInN0eWxlIiwid2lkdGgiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNyYyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhcHBlbmRDaGlsZCIsIm5hbWUiLCJpbm5lckhUTUwiLCJjcmVhdGVGYXZvcml0ZUJ1dHRvbiIsImltYWdlIiwiY2xhc3NOYW1lIiwic2V0QXR0cmlidXRlIiwic21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudCIsInRpdGxlIiwibmVpZ2hib3Job29kIiwiY3Vpc2luZV90eXBlIiwiY3Vpc2luZSIsImFkZHJlc3MiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZldGNoUmV2aWV3c0J5SWQiLCJmaWxsUmV2aWV3c0hUTUwiLCJmYXZvcml0ZSIsImdldEZhdm9yaXRlQnV0dG9uQ2xhc3MiLCJyZXN0YXVyYW50SWQiLCJpc0Zhdm9yaXRlIiwiaXNfZmF2b3JpdGUiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJmYXZvcml0ZUlkIiwidG9TdHJpbmciLCJxdWVyeVNlbGVjdG9yIiwib2ZmbGluZUZhdm9yaXRlTGFiZWwiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZXN0YXVyYW50SGVhZGVyIiwiaW5zZXJ0QmVmb3JlIiwidXBkYXRlRmF2b3JpdGUiLCJyZW1vdmUiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwidGltZSIsInJldmlld3MiLCJsb2ciLCJjb250YWluZXIiLCJyZXZpZXdzTGlzdCIsIm5vUmV2aWV3cyIsImZvckVhY2giLCJjcmVhdGVSZXZpZXdIVE1MIiwicmV2aWV3IiwibGkiLCJvZmZsaW5lUmV2aWV3TGFiZWwiLCJkZWxldGVCdXR0b24iLCJ0eXBlIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImRlbGV0ZVJldmlldyIsInRpbWVzdGFtcCIsImNyZWF0ZWRBdFRpbWVzdGFtcCIsIkRhdGUiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXRUaW1lc3RhbXAiLCJ1cGRhdGVkQXQiLCJ0b0xvY2FsZVN0cmluZyIsInJhdGluZyIsImNvbW1lbnRzIiwic3VibWl0UmV2aWV3IiwidmFsdWUiLCJyZXN0YXVyYW50X2lkIiwicGFyc2VJbnQiLCJnZXRUaW1lIiwib2ZmbGluZV9pZCIsImFkZFJldmlldyIsInJlc2V0IiwicmV2aWV3VG9EZWxldGUiLCJyZXZpZXdJZCIsIm9mZmxpbmVJZCIsInJlbW92ZVJldmlldyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVnZXgiLCJSZWdFeHAiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0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R0FBWCxDQURYO0FBRUEsS0FBSSxDQUFDTSxPQUFMLEVBQ0MsT0FBTyxJQUFQO0FBQ0QsS0FBSSxDQUFDQSxRQUFRLENBQVIsQ0FBTCxFQUNDLE9BQU8sRUFBUDtBQUNELFFBQU9FLG1CQUFtQkYsUUFBUSxDQUFSLEVBQVdILE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNBLENBWEQ7O0FBYUE7OztBQUdBLElBQU03RixpQkFBaUIsU0FBakJBLGNBQWlCLEdBQWtDO0FBQUEsS0FBakNoQyxVQUFpQyx1RUFBcEJhLEtBQUtiLFVBQWU7O0FBQ3hEO0FBQ0EsS0FBTW1JLFNBQVNuSCxTQUFTb0gsc0JBQVQsQ0FBZ0NwSSxVQUFoQyxFQUE0Q2EsS0FBS1osR0FBakQsQ0FBZjtBQUNBd0IsUUFBT0MsSUFBUCxDQUFZdUUsS0FBWixDQUFrQm9DLFdBQWxCLENBQThCRixNQUE5QixFQUFzQyxPQUF0QyxFQUErQyxZQUFNO0FBQ3BEN0gsU0FBT3FILFFBQVAsQ0FBZ0JDLElBQWhCLEdBQXVCTyxPQUFPVCxHQUE5QjtBQUNBLEVBRkQ7QUFHQSxDQU5EIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xubGV0IG1hcDtcbmxldCBsaXZlTWFwID0gZmFsc2U7XG5sZXQgaW5pdExvYWQgPSB0cnVlO1xubGV0IG9mZmxpbmVSZXZpZXdDb3VudGVyID0gMDtcbmxldCBvZmZsaW5lRmF2b3JpdGVDb3VudGVyID0gMDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuXHRmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuXHRcdGlmIChlcnJvcikgeyBcblx0XHRcdC8vIEdvdCBhbiBlcnJvciFcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IsIHJlc3RhdXJhbnQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmaWxsQnJlYWRjcnVtYigpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuXHRpZiAoc2VsZi5yZXN0YXVyYW50KSB7IFxuXHRcdC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuXHRcdGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cdGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXHRpZiAoIWlkKSB7IFxuXHRcdC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuXHRcdGNvbnN0IGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJztcblx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdH0gZWxzZSB7XG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG5cdFx0XHRzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuXHRcdFx0aWYgKCFyZXN0YXVyYW50KSB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRmaWxsUmVzdGF1cmFudEhUTUwoKTtcblx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuXHRcdH0pO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5cbi8qIElmIGEgbGl2ZSBtYXAgaXNuJ3QgYWxyZWFkeSBlbmFibGVkLCByZW1vdmVzIHRoZSBzdGF0aWMgbWFwIGltYWdlIGFuZCByZXBsYWNlcyBpdCB3aXRoIGEgbGl2ZSBHb29nbGUgTWFwLiAqL1xuY29uc3QgZ2V0TGl2ZU1hcCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG5cdGlmKGxpdmVNYXApe1xuXHRcdHJldHVybjtcblx0fSBlbHNlIHtcblx0XHRjb25zdCBzdGF0aWNNYXBJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdGljLW1hcC1pbWcnKTtcblx0XHRzdGF0aWNNYXBJbWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzdGF0aWNNYXBJbWcpO1xuXHRcdHNlbGYubWFwID0gbmV3IGdvb2dsZVxuXHRcdFx0Lm1hcHNcblx0XHRcdC5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG5cdFx0XHRcdHpvb206IDE2LFxuXHRcdFx0XHRjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0XHRzY3JvbGx3aGVlbDogZmFsc2Vcblx0XHRcdH0pO1xuXHRcdGFkZE1hcmtlclRvTWFwKCk7XG5cdFx0bGl2ZU1hcCA9IHRydWU7XG5cdH1cbn07XG5cbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG5cdC8qIExvYWRzIGEgc3RhdGljIG1hcCBpbWFnZSBpZiBpdCdzIHRoZSBpbml0aWFsIHBhZ2UgbG9hZC4gQWRkcyBhIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHNvIHRoYXQgd2hlbiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIG1hcCwgaXQgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgbG9hZHMgYSBsaXZlIG1hcCBpbiBpdHMgcGxhY2UuICovXG5cdGlmIChpbml0TG9hZCl7XG5cdFx0Y29uc3Qgc3RhdGljTWFwID0gREJIZWxwZXIuc3RhdGljSW1hZ2VGb3JNYXBSZXN0YXVyYW50SW5mbyhzZWxmLnJlc3RhdXJhbnQpO1xuXHRcdGNvbnN0IG1hcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblx0XHRjb25zdCBzdGF0aWNNYXBJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0XHRzdGF0aWNNYXBJbWcuaWQgPSAnc3RhdGljLW1hcC1pbWcnO1xuXHRcdHN0YXRpY01hcEltZy5hbHQgPSAnU3RhdGljIEdvb2dsZSBNYXBzIGltYWdlJztcblx0XHRzdGF0aWNNYXBJbWcuc3R5bGUud2lkdGggPSBgJHttYXAuY2xpZW50V2lkdGh9cHhgO1xuXHRcdHN0YXRpY01hcEltZy5zdHlsZS5oZWlnaHQgPSBgJHttYXAuY2xpZW50SGVpZ2h0fXB4YDtcblx0XHRzdGF0aWNNYXBJbWcuc3JjID0gc3RhdGljTWFwO1xuXHRcdHN0YXRpY01hcEltZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRcdGdldExpdmVNYXAoc2VsZi5yZXN0YXVyYW50KTtcblx0XHR9KTtcblx0XHRtYXAuYXBwZW5kQ2hpbGQoc3RhdGljTWFwSW1nKTtcblx0XHRpbml0TG9hZCA9IGZhbHNlO1xuXHR9IGVsc2Uge1xuXHRcdGFkZE1hcmtlclRvTWFwKCk7XG5cdH1cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcblx0bmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cblx0Y3JlYXRlRmF2b3JpdGVCdXR0b24ocmVzdGF1cmFudCk7XG5cblx0LyogTGF6eSBsb2FkcyBzbWFsbCBvciBsYXJnZSB2ZXJzaW9uIG9mIHJlc3RhdXJhbnQgaW1hZ2UgYmFzZWQgb24gZGF0YS1zcmNzZXQgYW5kIGF1dG8gZGF0YS1zaXplcy4gQWxzbyBkeW5hbWljYWxseSBzZXRzIGFsdCBhbmQgdGl0bGUgdGV4dCBvZiB0aGUgaW1hZ2UuICovXG5cdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyBsYXp5bG9hZCc7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBgJHtEQkhlbHBlci5zbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gNDAwd2ApO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JyxgJHtEQkhlbHBlci5zbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gNDAwdywgJHtEQkhlbHBlci5sYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gODAwd2ApO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2l6ZXMnLCAnYXV0bycpO1xuXHRpbWFnZS50aXRsZSA9IGAke3Jlc3RhdXJhbnQubmFtZX1gO1xuXHRpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IGluICR7cmVzdGF1cmFudC5uZWlnaGJvcmhvb2R9IC0gJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gcmVzdGF1cmFudGA7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcblx0Y3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuXHQvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuXHRpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcblx0XHRmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuXHR9XG5cdC8vIGZpbGwgcmV2aWV3c1xuXHREQkhlbHBlci5mZXRjaFJldmlld3NCeUlkKHJlc3RhdXJhbnQuaWQsIGZpbGxSZXZpZXdzSFRNTCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmYXZvcml0ZSBidXR0b24uIFdoZW4gY2xpY2tlZCwgbm90aWZpZXMgdXNlciB0aGF0IHJlc3RhdXJhbnQgZmF2b3JpdGUgaGFzIGJlZW4gYWRkZWQgb3IgcmVtb3ZlZCB2aWEgdmlzdWFsIGN1ZXMgYW5kIEFSSUEgbGFiZWwgY2hhbmdlcy4gQWxzbyB1cGRhdGVzIHNlcnZlciBhbmQgSW5kZXhlZERCIHdpdGggZmF2b3JpdGUgc3RhdHVzIG9mIHRoZSByZXN0YXVyYW50LiBJZiB1c2VyIGNsaWNrcyBvbiBmYXZvcml0ZSBidXR0b24gd2hpbGUgb2ZmbGluZSwgc3RvcmVzIGZhdm9yaXRlIHN0YXR1cyBpbiBsb2NhbCBzdG9yYWdlIGFuZCBjcmVhdGVzIGFuIG9mZmxpbmUgbGFiZWwgdG8gbm90aWZ5IHVzZXIgZmF2b3JpdGUgc3RhdHVzIHdpbGwgYmUgdXBkYXRlZCB3aGVuIG5ldHdvcmsgY29ubmVjdGlvbiBpcyByZWVzdGFibGlzaGVkLiBcbiAqL1xuY29uc3QgY3JlYXRlRmF2b3JpdGVCdXR0b24gPSAocmVzdGF1cmFudCkgPT4ge1xuXHRjb25zdCBmYXZvcml0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXZvcml0ZS1idXR0b24nKTtcblx0Z2V0RmF2b3JpdGVCdXR0b25DbGFzcyhyZXN0YXVyYW50LCBmYXZvcml0ZSk7XG5cblx0ZmF2b3JpdGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0Y29uc3QgcmVzdGF1cmFudElkID0gcmVzdGF1cmFudC5pZDtcblx0XHRsZXQgaXNGYXZvcml0ZTtcblxuXHRcdGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICdmYWxzZScpe1xuXHRcdFx0aXNGYXZvcml0ZSA9ICd0cnVlJztcblx0XHRcdGZhdm9yaXRlLnRpdGxlID0gJ1JlbW92ZSBmcm9tIGZhdm9yaXRlcyc7XG5cdFx0XHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUmVtb3ZlIGZyb20gZmF2b3JpdGVzJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlzRmF2b3JpdGUgPSAnZmFsc2UnO1xuXHRcdFx0ZmF2b3JpdGUudGl0bGUgPSAnQWRkIHRvIGZhdm9yaXRlcyc7XG5cdFx0XHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHRvIGZhdm9yaXRlcycpO1xuXHRcdH1cblx0XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xuXHRcdFx0LyogQ3JlYXRlcyB1bmlxdWUgaWQgdG8gcmVmZXJlbmNlIGZhdm9yaXRlIHN0YXR1cyBpbiBsb2NhbCBzdG9yYWdlLiAqL1xuXHRcdFx0b2ZmbGluZUZhdm9yaXRlQ291bnRlcisrO1xuXHRcdFx0bGV0IGZhdm9yaXRlSWQgPSBvZmZsaW5lRmF2b3JpdGVDb3VudGVyLnRvU3RyaW5nKCk7XG5cdFx0XHQvKiBNYWtlIHN1cmUgb25seSBvbmUgb2ZmbGluZSBsYWJlbCBpcyBjcmVhdGVkIG5vIG1hdHRlciBob3cgbWFueSB0aW1lcyB1c2VyIGNsaWNrcyBvbiBmYXZvcml0ZSBidXR0b24gKi9cblx0XHRcdGlmKCFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub2ZmbGluZS1mYXZvcml0ZS1sYWJlbCcpKXtcblx0XHRcdFx0Y29uc3Qgb2ZmbGluZUZhdm9yaXRlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdFx0b2ZmbGluZUZhdm9yaXRlTGFiZWwuY2xhc3NMaXN0LmFkZCgnb2ZmbGluZS1mYXZvcml0ZS1sYWJlbCcpO1xuXHRcdFx0XHRvZmZsaW5lRmF2b3JpdGVMYWJlbC5pbm5lckhUTUwgPSBgPGkgY2xhc3M9XCJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGVcIj48L2k+IE9mZmxpbmUgTW9kZSAtIEZhdm9yaXRlIHN0YXR1cyB3aWxsIHN1Ym1pdCB3aGVuIG5ldHdvcmsgY29ubmVjdGlvbiBpcyByZWVzdGFibGlzaGVkYDtcblx0XHRcdFx0Y29uc3QgcmVzdGF1cmFudEhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhlYWRlcicpO1xuXHRcdFx0XHRyZXN0YXVyYW50SGVhZGVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG9mZmxpbmVGYXZvcml0ZUxhYmVsLCByZXN0YXVyYW50SGVhZGVyKTtcblx0XHRcdH1cblx0XHRcdERCSGVscGVyLnVwZGF0ZUZhdm9yaXRlKGZhdm9yaXRlSWQsIHJlc3RhdXJhbnRJZCwgaXNGYXZvcml0ZSk7XG5cdFx0XHRyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gaXNGYXZvcml0ZTtcblx0XHRcdGdldEZhdm9yaXRlQnV0dG9uQ2xhc3MocmVzdGF1cmFudCwgZmF2b3JpdGUpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH0gXG5cdFx0REJIZWxwZXIudXBkYXRlRmF2b3JpdGUobnVsbCwgcmVzdGF1cmFudElkLCBpc0Zhdm9yaXRlKTtcblx0XHRyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gaXNGYXZvcml0ZTtcblx0XHRnZXRGYXZvcml0ZUJ1dHRvbkNsYXNzKHJlc3RhdXJhbnQsIGZhdm9yaXRlKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIENoYW5nZSBmYXZvcml0ZSBidXR0b24gdG8gYXBwZWFyIG9uIG9yIG9mZiB3aXRoIGNsYXNzIGNoYW5nZS5cbiAqL1xuY29uc3QgZ2V0RmF2b3JpdGVCdXR0b25DbGFzcyA9IChyZXN0YXVyYW50LCBmYXZvcml0ZSkgPT4ge1xuXHRpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnKXtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdyZXN0YXVyYW50LWZhdm9yaXRlLXRydWUnKTtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QucmVtb3ZlKCdyZXN0YXVyYW50LWZhdm9yaXRlLWZhbHNlJyk7XG5cdFx0ZmF2b3JpdGUuaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFzIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH0gZWxzZSB7XG5cdFx0ZmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgncmVzdGF1cmFudC1mYXZvcml0ZS1mYWxzZScpO1xuXHRcdGZhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ3Jlc3RhdXJhbnQtZmF2b3JpdGUtdHJ1ZScpO1xuXHRcdGZhdm9yaXRlLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhciBmYS1oZWFydFwiPjwvaT4nO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuXHRjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG5cdGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuXHRcdGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cdFx0Y29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHRkYXkuaW5uZXJIVE1MID0ga2V5O1xuXHRcdHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXHRcdGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcblx0XHRyb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cdFx0aG91cnMuYXBwZW5kQ2hpbGQocm93KTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChlcnJvciwgcmV2aWV3cykgPT4ge1xuXHRpZihlcnJvcil7XG5cdFx0Y29uc29sZS5sb2coZXJyb3IpO1xuXHR9XG5cdHNlbGYucmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG5cdGNvbnN0IHJldmlld3NMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuXHRyZXZpZXdzTGlzdC5pbm5lckhUTUwgPSAnJztcblx0aWYgKCFyZXZpZXdzKSB7XG5cdFx0Y29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdG5vUmV2aWV3cy5pZCA9ICduby1yZXZpZXdzJztcblx0XHRub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG5cdFx0Y29udGFpbmVyLmluc2VydEJlZm9yZShub1Jldmlld3MsIHJldmlld3NMaXN0KTtcblx0fSBlbHNlIHtcblx0XHRyZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcblx0XHRcdHJldmlld3NMaXN0LmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG5cdFx0fSk7XG5cdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHJldmlld3NMaXN0KTtcblx0fVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG5cdC8qIENyZWF0ZSBsYWJlbCBmb3IgcmV2aWV3cyBzdWJtaXR0ZWQgd2hpbGUgb2ZmbGluZS4gKi9cblx0aWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0Y29uc3Qgb2ZmbGluZVJldmlld0xhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0b2ZmbGluZVJldmlld0xhYmVsLmNsYXNzTGlzdC5hZGQoJ29mZmxpbmUtcmV2aWV3LWxhYmVsJyk7XG5cdFx0b2ZmbGluZVJldmlld0xhYmVsLmlubmVySFRNTCA9IGA8aSBjbGFzcz1cImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZVwiPjwvaT4gT2ZmbGluZSBNb2RlIC0gUmV2aWV3IHdpbGwgc3VibWl0IHdoZW4gbmV0d29yayBjb25uZWN0aW9uIGlzIHJlZXN0YWJsaXNoZWRgO1xuXHRcdGxpLmFwcGVuZENoaWxkKG9mZmxpbmVSZXZpZXdMYWJlbCk7XG5cdH1cblxuXHQvKiBDcmVhdGUgZGVsZXRlIGJ1dHRvbiB0byByZW1vdmUgcmV2aWV3cyAqL1xuXHRjb25zdCBkZWxldGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblx0ZGVsZXRlQnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcblx0ZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2RlbGV0ZS1idXR0b24nKTtcblx0ZGVsZXRlQnV0dG9uLnRpdGxlID0gJ0RlbGV0ZSByZXZpZXcnO1xuXHRkZWxldGVCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0RlbGV0ZSByZXZpZXcnKTtcblx0ZGVsZXRlQnV0dG9uLmlubmVySFRNTCA9IGA8aSBjbGFzcz1cImZhcyBmYS10cmFzaC1hbHRcIj48L2k+YDtcblx0bGkuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTtcblx0ZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0ZGVsZXRlUmV2aWV3KGRlbGV0ZUJ1dHRvbiwgcmV2aWV3KTtcblx0fSk7XG5cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0bmFtZS5jbGFzc0xpc3QuYWRkKCdyZXZpZXctaGVhZGVyJyk7XG5cdG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG5cdGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG5cdC8qIENvbnZlcnQgdGltZXN0YW1wIGZyb20gZXBvY2ggdGltZSBpbnRvIGEgbW9yZSByZWFkYWJsZSBmb3JtYXQuICovXG5cdGNvbnN0IHRpbWVzdGFtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0dGltZXN0YW1wLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1oZWFkZXInKTtcblx0Y29uc3QgY3JlYXRlZEF0VGltZXN0YW1wID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCk7XG5cdGNvbnN0IHVwZGF0ZWRBdFRpbWVzdGFtcCA9IG5ldyBEYXRlKHJldmlldy51cGRhdGVkQXQpO1xuXHRpZiAoY3JlYXRlZEF0VGltZXN0YW1wID09PSB1cGRhdGVkQXRUaW1lc3RhbXApe1xuXHRcdHRpbWVzdGFtcC5pbm5lckhUTUwgPSBjcmVhdGVkQXRUaW1lc3RhbXAudG9Mb2NhbGVTdHJpbmcoKTtcblx0fSBlbHNlIHtcblx0XHR0aW1lc3RhbXAuaW5uZXJIVE1MID0gdXBkYXRlZEF0VGltZXN0YW1wLnRvTG9jYWxlU3RyaW5nKCk7XG5cdH1cblx0bGkuYXBwZW5kQ2hpbGQodGltZXN0YW1wKTtcblxuXHRjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0cmF0aW5nLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1yYXRpbmcnKTtcblx0aWYgKHJldmlldy5yYXRpbmcgPiAxKXtcblx0XHRyYXRpbmcudGl0bGUgPSBgJHtyZXZpZXcucmF0aW5nfSBzdGFyc2A7XG5cdFx0cmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGAke3Jldmlldy5yYXRpbmd9IHN0YXJzYCk7XG5cdH0gZWxzZSB7XG5cdFx0cmF0aW5nLnRpdGxlID0gYCR7cmV2aWV3LnJhdGluZ30gc3RhcmA7XG5cdFx0cmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGAke3Jldmlldy5yYXRpbmd9IHN0YXJgKTtcblx0fVxuXHRyYXRpbmcuaW5uZXJIVE1MID0gYCR7cmV2aWV3LnJhdGluZ30gPGkgY2xhc3M9XCJmYXMgZmEtc3RhclwiPjwvaT5gO1xuXHRsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG5cdGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG5cdGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuXHRyZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIEFkZCB1c2VyIHJldmlldyB0byB0aGUgcGFnZSwgc3RvcmUgcmV2aWV3IGRhdGEgaW4gc2VydmVyICYgSW5kZXhlZERCLCBhbmQgcmVzZXQgZm9ybS4gRm9yIG9mZmxpbmUgc3VibWl0dGVkIHJldmlld3MsIGNyZWF0ZXMgYSBjb3VudGVyIHRvIHByb3ZpZGUgYSB1bmlxdWUgSUQgbnVtYmVyIGZvciBlYWNoIG9mZmxpbmUgcmV2aWV3IHNhdmVkIGluIGxvY2FsIHN0b3JhZ2UuXG4gKi9cbmNvbnN0IHN1Ym1pdFJldmlldyA9ICgpID0+IHtcblx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0b2ZmbGluZVJldmlld0NvdW50ZXIrKztcblx0Y29uc3QgcmVzdGF1cmFudElkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0tbmFtZScpLnZhbHVlO1xuXHRjb25zdCByYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZm9ybS1yYXRpbmcgb3B0aW9uOmNoZWNrZWQnKS52YWx1ZTtcblx0Y29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybS1jb21tZW50cycpLnZhbHVlO1xuXHRjb25zdCByZXZpZXcgPSB7XG5cdFx0cmVzdGF1cmFudF9pZDogcGFyc2VJbnQocmVzdGF1cmFudElkKSxcblx0XHRuYW1lOiBuYW1lLFxuXHRcdGNyZWF0ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG5cdFx0dXBkYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcblx0XHRyYXRpbmc6IHBhcnNlSW50KHJhdGluZyksXG5cdFx0Y29tbWVudHM6IGNvbW1lbnRzLFxuXHRcdG9mZmxpbmVfaWQ6IG9mZmxpbmVSZXZpZXdDb3VudGVyLnRvU3RyaW5nKCksXG5cdH07XG5cdGNvbnN0IHJldmlld3NMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuXHRyZXZpZXdzTGlzdC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuXHREQkhlbHBlci5hZGRSZXZpZXcocmV2aWV3LCByZXN0YXVyYW50SWQsIGZpbGxSZXZpZXdzSFRNTCk7XG5cdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtJykucmVzZXQoKTtcblx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xuXHRcdGNvbnNvbGUubG9nKCdZb3VyIHJldmlldyB3aWxsIGJlIHN1Ym1pdHRlZCB3aGVuIGFuIG9ubGluZSBjb25uZWN0aW9uIGlzIHJlZXN0YWJsaXNoZWQnKTtcblx0fSBlbHNlIHtcblx0XHRjb25zb2xlLmxvZygnWW91ciByZXZpZXcgaGFzIGJlZW4gc3VibWl0dGVkIScpO1xuXHR9XG59O1xuXG4vKipcbiAqIERlbGV0ZSB1c2VyIHJldmlldyBmcm9tIHRoZSBwYWdlIGFuZCByZW1vdmUgcmV2aWV3IGRhdGEgZnJvbSBzZXJ2ZXIgJiBJbmRleGVkREIuXG4gKi9cbmNvbnN0IGRlbGV0ZVJldmlldyA9IChkZWxldGVCdXR0b24sIHJldmlldykgPT4ge1xuXHRjb25zdCByZXZpZXdUb0RlbGV0ZSA9IGRlbGV0ZUJ1dHRvbi5wYXJlbnROb2RlO1xuXHRjb25zdCByZXZpZXdJZCA9IHJldmlldy5pZDtcblx0Y29uc3Qgb2ZmbGluZUlkID0gcmV2aWV3Lm9mZmxpbmVfaWQ7XG5cdGNvbnN0IHJlc3RhdXJhbnRJZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcblx0REJIZWxwZXIucmVtb3ZlUmV2aWV3KHJldmlld0lkLCBvZmZsaW5lSWQsIHJlc3RhdXJhbnRJZCwgZmlsbFJldmlld3NIVE1MKTtcblx0Y29uc3QgcmV2aWV3c0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG5cdHJldmlld3NMaXN0LnJlbW92ZUNoaWxkKHJldmlld1RvRGVsZXRlKTtcbn07XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuXHRjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cblx0Ly9TZXQgQVJJQSBhdHRyaWJ1dGVzIHNvIHNjcmVlbnJlYWRlciBrbm93cyBpdHMgb24gdGhlIGN1cnJlbnQgcGFnZSBmb3IgdGhlIHJlc3RhdXJhbnQgaW4gdGhlIGJyZWFkY3J1bWIgdHJhaWwuXG5cdGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJlc3RhdXJhbnQubmFtZSk7XG5cdGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScsICdicmVhZGNydW1iLWRlc2NyaXB0aW9uJyk7XG5cdGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuXG5cdC8vRHluYW1pY2FsbHkgc2V0IHRpdGxlIGF0dHJpYnV0ZVxuXHRsaS50aXRsZSA9IHJlc3RhdXJhbnQubmFtZTtcblx0YnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcblx0aWYgKCF1cmwpXG5cdFx0dXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cdG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcblx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG5cdFx0cmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcblx0aWYgKCFyZXN1bHRzKVxuXHRcdHJldHVybiBudWxsO1xuXHRpZiAoIXJlc3VsdHNbMl0pXG5cdFx0cmV0dXJuICcnO1xuXHRyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VyIGZvciBjdXJyZW50IHJlc3RhdXJhbnQgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2VyVG9NYXAgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuXHQvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcblx0Y29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuXHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcblx0fSk7XG59O1xuXG4iXX0=
