'use strict';

var restaurants = void 0,
    neighborhoods = void 0,
    cuisines = void 0,
    map = void 0;
var liveMap = false;
var initLoad = true;
var markers = [];

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', function (event) {
	fetchNeighborhoods();
	fetchCuisines();
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
var fetchNeighborhoods = function fetchNeighborhoods() {
	DBHelper.fetchNeighborhoods(function (error, neighborhoods) {
		if (error) {
			// Got an error
			console.error(error);
		} else {
			self.neighborhoods = neighborhoods;
			fillNeighborhoodsHTML();
		}
	});
};

/**
 * Set neighborhoods HTML.
 */
var fillNeighborhoodsHTML = function fillNeighborhoodsHTML() {
	var neighborhoods = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.neighborhoods;

	var select = document.getElementById('neighborhoods-select');
	neighborhoods.forEach(function (neighborhood) {
		var option = document.createElement('option');
		option.innerHTML = neighborhood;
		option.value = neighborhood;
		select.append(option);
	});
};

/**
 * Fetch all cuisines and set their HTML.
 */
var fetchCuisines = function fetchCuisines() {
	DBHelper.fetchCuisines(function (error, cuisines) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			self.cuisines = cuisines;
			fillCuisinesHTML();
		}
	});
};

/**
 * Set cuisines HTML.
 */
var fillCuisinesHTML = function fillCuisinesHTML() {
	var cuisines = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.cuisines;

	var select = document.getElementById('cuisines-select');

	cuisines.forEach(function (cuisine) {
		var option = document.createElement('option');
		option.innerHTML = cuisine;
		option.value = cuisine;
		select.append(option);
	});
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
var updateRestaurants = function updateRestaurants() {
	var cSelect = document.getElementById('cuisines-select');
	var nSelect = document.getElementById('neighborhoods-select');

	var cIndex = cSelect.selectedIndex;
	var nIndex = nSelect.selectedIndex;

	var cuisine = cSelect[cIndex].value;
	var neighborhood = nSelect[nIndex].value;

	DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, function (error, restaurants) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			resetRestaurants(restaurants);
			fillRestaurantsHTML();
		}
	});
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
var resetRestaurants = function resetRestaurants(restaurants) {
	// Remove all restaurants
	self.restaurants = [];
	var ul = document.getElementById('restaurants-list');
	ul.innerHTML = '';

	// Remove all map markers
	self.markers.forEach(function (m) {
		return m.setMap(null);
	});
	self.markers = [];
	self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	updateRestaurants();
	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		var loc = {
			lat: 40.722216,
			lng: -73.987501
		};
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 12,
			center: loc,
			scrollwheel: false
		});
		liveMap = true;
	}
};

var fillRestaurantsHTML = function fillRestaurantsHTML() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	var ul = document.getElementById('restaurants-list');
	restaurants.forEach(function (restaurant) {
		ul.append(createRestaurantHTML(restaurant));
	});

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		fetchNeighborhoods();
		fetchCuisines();
		var staticMap = DBHelper.staticImageForMapIndex(self.restaurants);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap();
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkersToMap();
	}
};

/**
 * Create restaurant HTML.
 */
var createRestaurantHTML = function createRestaurantHTML(restaurant) {
	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var li = document.createElement('li');
	var image = document.createElement('img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';
	li.append(image);

	//Create header to hold name & favorite button
	var header = document.createElement('div');
	header.id = "header";
	li.append(header);

	var name = document.createElement('h3');
	name.innerHTML = restaurant.name;
	header.append(name);

	//Create dynamic favorite button
	var favorite = document.createElement('button');
	favorite.type = 'button';
	favorite.id = 'favorite-button';
	favorite.title = 'Add to favorites';
	favorite.setAttribute('aria-label', 'Add to favorites');
	favorite.setAttribute('onclick', 'updateFavorite()');
	if (restaurant.is_favorite === true) {
		favorite.className = 'index-favorite-true';
		favorite.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favorite.className = 'index-favorite-false';
		favorite.innerHTML = '<i class="far fa-heart"></i>';
	}
	header.append(favorite);

	var neighborhood = document.createElement('p');
	neighborhood.innerHTML = restaurant.neighborhood;
	li.append(neighborhood);

	var address = document.createElement('p');
	address.innerHTML = restaurant.address;
	li.append(address);

	//Create empty element so flex grow can be applied and create space to vertically align View Details buttons.
	var empty = document.createElement('p');
	empty.className = 'restaurant-empty';
	li.append(empty);

	var more = document.createElement('a');
	more.innerHTML = 'View Restaurant Details';
	more.href = DBHelper.urlForRestaurant(restaurant);

	//Dynamically set title attribute
	more.title = restaurant.name + ' - View Restaurant Details';

	//Set ARIA attributes to each restaurant link
	more.setAttribute('role', 'button');
	more.setAttribute('tabindex', '0');
	more.setAttribute('aria-label', 'View' + restaurant.name + 'Restaurant Details');
	li.append(more);

	return li;
};

/**
 * Add markers for current restaurants to the map.
 */
var addMarkersToMap = function addMarkersToMap() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	restaurants.forEach(function (restaurant) {
		// Add marker to the map
		var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
		google.maps.event.addListener(marker, 'click', function () {
			window.location.href = marker.url;
		});
		self.markers.push(marker);
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJsaXZlTWFwIiwiaW5pdExvYWQiLCJtYXJrZXJzIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiREJIZWxwZXIiLCJlcnJvciIsImNvbnNvbGUiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JFYWNoIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsIm5laWdoYm9yaG9vZCIsInZhbHVlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJ3aW5kb3ciLCJpbml0TWFwIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwibSIsInNldE1hcCIsImdldExpdmVNYXAiLCJzdGF0aWNNYXBJbWciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJsb2MiLCJsYXQiLCJsbmciLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJyZXN0YXVyYW50Iiwic3RhdGljTWFwIiwic3RhdGljSW1hZ2VGb3JNYXBJbmRleCIsImlkIiwiYWx0Iiwic3R5bGUiLCJ3aWR0aCIsImNsaWVudFdpZHRoIiwiaGVpZ2h0IiwiY2xpZW50SGVpZ2h0Iiwic3JjIiwiYXBwZW5kQ2hpbGQiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlIiwiY2xhc3NOYW1lIiwic2V0QXR0cmlidXRlIiwic21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudCIsInRpdGxlIiwibmFtZSIsImN1aXNpbmVfdHlwZSIsImhlYWRlciIsImZhdm9yaXRlIiwidHlwZSIsImlzX2Zhdm9yaXRlIiwiYWRkcmVzcyIsImVtcHR5IiwibW9yZSIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50IiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJ1cmwiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLG9CQUFKO0FBQUEsSUFDQ0Msc0JBREQ7QUFBQSxJQUVDQyxpQkFGRDtBQUFBLElBR0NDLFlBSEQ7QUFJQSxJQUFJQyxVQUFVLEtBQWQ7QUFDQSxJQUFJQyxXQUFXLElBQWY7QUFDQSxJQUFJQyxVQUFVLEVBQWQ7O0FBRUE7OztBQUdBQyxTQUFTQyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsVUFBQ0MsS0FBRCxFQUFXO0FBQ3hEQztBQUNBQztBQUNBLENBSEQ7O0FBS0E7OztBQUdBLElBQU1ELHFCQUFxQixTQUFyQkEsa0JBQXFCLEdBQU07QUFDaENFLFVBQVNGLGtCQUFULENBQTRCLFVBQUNHLEtBQUQsRUFBUVosYUFBUixFQUEwQjtBQUNyRCxNQUFJWSxLQUFKLEVBQVc7QUFDVjtBQUNBQyxXQUFRRCxLQUFSLENBQWNBLEtBQWQ7QUFDQSxHQUhELE1BR087QUFDTkUsUUFBS2QsYUFBTCxHQUFxQkEsYUFBckI7QUFDQWU7QUFDQTtBQUNELEVBUkQ7QUFTQSxDQVZEOztBQVlBOzs7QUFHQSxJQUFNQSx3QkFBd0IsU0FBeEJBLHFCQUF3QixHQUF3QztBQUFBLEtBQXZDZixhQUF1Qyx1RUFBdkJjLEtBQUtkLGFBQWtCOztBQUNyRSxLQUFNZ0IsU0FBU1YsU0FBU1csY0FBVCxDQUF3QixzQkFBeEIsQ0FBZjtBQUNBakIsZUFBY2tCLE9BQWQsQ0FBc0Isd0JBQWdC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V0FBV29CLElBQTNCOztBQUVBO0FBQ0FRLE1BQUtaLFlBQUwsQ0FBa0IsTUFBbEIsRUFBMEIsUUFBMUI7QUFDQVksTUFBS1osWUFBTCxDQUFrQixVQUFsQixFQUE4QixHQUE5QjtBQUNBWSxNQUFLWixZQUFMLENBQWtCLFlBQWxCLEVBQWdDLFNBQVNoQixXQUFXb0IsSUFBcEIsR0FBMkIsb0JBQTNEO0FBQ0FQLElBQUc1QyxNQUFILENBQVUyRCxJQUFWOztBQUVBLFFBQU9mLEVBQVA7QUFDQSxDQWhFRDs7QUFrRUE7OztBQUdBLElBQU1ELGtCQUFrQixTQUFsQkEsZUFBa0IsR0FBb0M7QUFBQSxLQUFuQ3BFLFdBQW1DLHVFQUFyQmUsS0FBS2YsV0FBZ0I7O0FBQzNEQSxhQUFZbUIsT0FBWixDQUFvQixzQkFBYztBQUNqQztBQUNBLE1BQU1vRSxTQUFTM0UsU0FBUzRFLHNCQUFULENBQWdDaEMsVUFBaEMsRUFBNEN6QyxLQUFLWixHQUFqRCxDQUFmO0FBQ0E4QyxTQUFPQyxJQUFQLENBQVl6QyxLQUFaLENBQWtCZ0YsV0FBbEIsQ0FBOEJGLE1BQTlCLEVBQXNDLE9BQXRDLEVBQStDLFlBQU07QUFDcEQzRCxVQUFPOEQsUUFBUCxDQUFnQkwsSUFBaEIsR0FBdUJFLE9BQU9JLEdBQTlCO0FBQ0EsR0FGRDtBQUdBNUUsT0FBS1QsT0FBTCxDQUFhc0YsSUFBYixDQUFrQkwsTUFBbEI7QUFDQSxFQVBEO0FBUUEsQ0FURCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRzLFxuXHRuZWlnaGJvcmhvb2RzLFxuXHRjdWlzaW5lcyxcblx0bWFwO1xubGV0IGxpdmVNYXAgPSBmYWxzZTtcbmxldCBpbml0TG9hZCA9IHRydWU7XG5sZXQgbWFya2VycyA9IFtdO1xuXG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG5cdGZldGNoTmVpZ2hib3Job29kcygpO1xuXHRmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcblx0REJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xuXHRcdGlmIChlcnJvcikgeyBcblx0XHRcdC8vIEdvdCBhbiBlcnJvclxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG5cdFx0XHRmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcblx0bmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG5cdFx0b3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcblx0XHRvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG5cdFx0c2VsZWN0LmFwcGVuZChvcHRpb24pO1xuXHR9KTtcbn07XG5cbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcblx0REJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XG5cdFx0aWYgKGVycm9yKSB7IFxuXHRcdFx0Ly8gR290IGFuIGVycm9yIVxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcblx0XHRcdGZpbGxDdWlzaW5lc0hUTUwoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuY29uc3QgZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG5cdGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG5cdFx0b3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XG5cdFx0b3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuXHR1cGRhdGVSZXN0YXVyYW50cygpO1xufTtcblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcblx0Y29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcblx0Y29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG5cdGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcblx0Y29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG5cdGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuXHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcblx0XHRcdGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbmNvbnN0IHJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcblx0Ly8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuXHRzZWxmLnJlc3RhdXJhbnRzID0gW107XG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcblx0dWwuaW5uZXJIVE1MID0gJyc7XG5cblx0Ly8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuXHRzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcblx0c2VsZi5tYXJrZXJzID0gW107XG5cdHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuXG4vKiBJZiBhIGxpdmUgbWFwIGlzbid0IGFscmVhZHkgZW5hYmxlZCwgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgcmVwbGFjZXMgaXQgd2l0aCBhIGxpdmUgR29vZ2xlIE1hcC4gKi9cbmNvbnN0IGdldExpdmVNYXAgPSAoKSA9PiB7XG5cdHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG5cdGlmKGxpdmVNYXApe1xuXHRcdHJldHVybjtcblx0fSBlbHNlIHtcblx0XHRjb25zdCBzdGF0aWNNYXBJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdGljLW1hcC1pbWcnKTtcblx0XHRzdGF0aWNNYXBJbWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzdGF0aWNNYXBJbWcpO1xuXHRcdGxldCBsb2MgPSB7XG5cdFx0XHRsYXQ6IDQwLjcyMjIxNixcblx0XHRcdGxuZzogLTczLjk4NzUwMVxuXHRcdH07XG5cdFx0c2VsZi5tYXAgPSBuZXcgZ29vZ2xlXG5cdFx0XHQubWFwc1xuXHRcdFx0Lk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcblx0XHRcdFx0em9vbTogMTIsXG5cdFx0XHRcdGNlbnRlcjogbG9jLFxuXHRcdFx0XHRzY3JvbGx3aGVlbDogZmFsc2Vcblx0XHRcdH0pO1xuXHRcdGxpdmVNYXAgPSB0cnVlO1xuXHR9XG59O1xuXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG5cdHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0dWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcblx0fSk7XG5cdFxuXHQvKiBMb2FkcyBhIHN0YXRpYyBtYXAgaW1hZ2UgaWYgaXQncyB0aGUgaW5pdGlhbCBwYWdlIGxvYWQuIEFkZHMgYSBjbGljayBldmVudCBsaXN0ZW5lciBzbyB0aGF0IHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSBtYXAsIGl0IHJlbW92ZXMgdGhlIHN0YXRpYyBtYXAgaW1hZ2UgYW5kIGxvYWRzIGEgbGl2ZSBtYXAgaW4gaXRzIHBsYWNlLiAqL1xuXHRpZiAoaW5pdExvYWQpe1xuXHRcdGZldGNoTmVpZ2hib3Job29kcygpO1xuXHRcdGZldGNoQ3Vpc2luZXMoKTtcblx0XHRjb25zdCBzdGF0aWNNYXAgPSBEQkhlbHBlci5zdGF0aWNJbWFnZUZvck1hcEluZGV4KHNlbGYucmVzdGF1cmFudHMpO1xuXHRcdGNvbnN0IG1hcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblx0XHRjb25zdCBzdGF0aWNNYXBJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0XHRzdGF0aWNNYXBJbWcuaWQgPSAnc3RhdGljLW1hcC1pbWcnO1xuXHRcdHN0YXRpY01hcEltZy5hbHQgPSAnU3RhdGljIEdvb2dsZSBNYXBzIGltYWdlJztcblx0XHRzdGF0aWNNYXBJbWcuc3R5bGUud2lkdGggPSBgJHttYXAuY2xpZW50V2lkdGh9cHhgO1xuXHRcdHN0YXRpY01hcEltZy5zdHlsZS5oZWlnaHQgPSBgJHttYXAuY2xpZW50SGVpZ2h0fXB4YDtcblx0XHRzdGF0aWNNYXBJbWcuc3JjID0gc3RhdGljTWFwO1xuXHRcdHN0YXRpY01hcEltZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRcdGdldExpdmVNYXAoKTtcblx0XHR9KTtcblx0XHRtYXAuYXBwZW5kQ2hpbGQoc3RhdGljTWFwSW1nKTtcblx0XHRpbml0TG9hZCA9IGZhbHNlO1xuXHR9IGVsc2Uge1xuXHRcdGFkZE1hcmtlcnNUb01hcCgpO1xuXHR9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gcmVzdGF1cmFudCA9PiB7XG5cdC8qIExhenkgbG9hZHMgc21hbGwgb3IgbGFyZ2UgdmVyc2lvbiBvZiByZXN0YXVyYW50IGltYWdlIGJhc2VkIG9uIGRhdGEtc3Jjc2V0IGFuZCBhdXRvIGRhdGEtc2l6ZXMuIEFsc28gZHluYW1pY2FsbHkgc2V0cyBhbHQgYW5kIHRpdGxlIHRleHQgb2YgdGhlIGltYWdlLiAqL1xuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7IFxuXHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcgbGF6eWxvYWQnO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgYCR7REJIZWxwZXIuc21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDQwMHdgKTtcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsYCR7REJIZWxwZXIuc21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDQwMHcsICR7REJIZWxwZXIubGFyZ2VJbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9IDgwMHdgKTtcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNpemVzJywgJ2F1dG8nKTtcblx0aW1hZ2UudGl0bGUgPSBgJHtyZXN0YXVyYW50Lm5hbWV9YDtcblx0aW1hZ2UuYWx0ID0gYCR7cmVzdGF1cmFudC5uYW1lfSBpbiAke3Jlc3RhdXJhbnQubmVpZ2hib3Job29kfSAtICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9IHJlc3RhdXJhbnRgO1xuXHRsaS5hcHBlbmQoaW1hZ2UpO1xuXG5cdC8vQ3JlYXRlIGhlYWRlciB0byBob2xkIG5hbWUgJiBmYXZvcml0ZSBidXR0b25cblx0Y29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdGhlYWRlci5pZCA9IFwiaGVhZGVyXCI7XG5cdGxpLmFwcGVuZChoZWFkZXIpO1xuXG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuXHRuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblx0aGVhZGVyLmFwcGVuZChuYW1lKTtcblxuXHQvL0NyZWF0ZSBkeW5hbWljIGZhdm9yaXRlIGJ1dHRvblxuXHRjb25zdCBmYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRmYXZvcml0ZS50eXBlID0gJ2J1dHRvbic7XG5cdGZhdm9yaXRlLmlkID0gJ2Zhdm9yaXRlLWJ1dHRvbic7XG5cdGZhdm9yaXRlLnRpdGxlID0gJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHRvIGZhdm9yaXRlcycpO1xuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ29uY2xpY2snLCAndXBkYXRlRmF2b3JpdGUoKScpO1xuXHRpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSl7XG5cdFx0ZmF2b3JpdGUuY2xhc3NOYW1lID0gJ2luZGV4LWZhdm9yaXRlLXRydWUnO1xuXHRcdGZhdm9yaXRlLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhcyBmYS1oZWFydFwiPjwvaT4nO1xuXHR9IGVsc2Uge1xuXHRcdGZhdm9yaXRlLmNsYXNzTmFtZSA9ICdpbmRleC1mYXZvcml0ZS1mYWxzZSc7XG5cdFx0ZmF2b3JpdGUuaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFyIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH1cblx0aGVhZGVyLmFwcGVuZChmYXZvcml0ZSk7XG5cblx0Y29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG5cdGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG5cdGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXHRsaS5hcHBlbmQoYWRkcmVzcyk7XG5cblx0Ly9DcmVhdGUgZW1wdHkgZWxlbWVudCBzbyBmbGV4IGdyb3cgY2FuIGJlIGFwcGxpZWQgYW5kIGNyZWF0ZSBzcGFjZSB0byB2ZXJ0aWNhbGx5IGFsaWduIFZpZXcgRGV0YWlscyBidXR0b25zLlxuXHRjb25zdCBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0ZW1wdHkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtZW1wdHknO1xuXHRsaS5hcHBlbmQoZW1wdHkpO1xuXG5cdGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgUmVzdGF1cmFudCBEZXRhaWxzJztcblx0bW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuXHQvL0R5bmFtaWNhbGx5IHNldCB0aXRsZSBhdHRyaWJ1dGVcblx0bW9yZS50aXRsZSA9IGAke3Jlc3RhdXJhbnQubmFtZX0gLSBWaWV3IFJlc3RhdXJhbnQgRGV0YWlsc2A7XG5cblx0Ly9TZXQgQVJJQSBhdHRyaWJ1dGVzIHRvIGVhY2ggcmVzdGF1cmFudCBsaW5rXG5cdG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xuXHRtb3JlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuXHRtb3JlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdWaWV3JyArIHJlc3RhdXJhbnQubmFtZSArICdSZXN0YXVyYW50IERldGFpbHMnKTtcblx0bGkuYXBwZW5kKG1vcmUpO1xuXG5cdHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuXHRcdC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuXHRcdGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuXHRcdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuXHRcdH0pO1xuXHRcdHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG5cdH0pO1xufTtcbiJdfQ==
