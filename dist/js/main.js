"use strict";var restaurants=void 0,neighborhoods=void 0,cuisines=void 0,map=void 0,liveMap=!1,initLoad=!0,markers=[],offlineFavoriteCounter=0;document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,a=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,a.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,a=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,a.append(t)})};window.initMap=function(){updateRestaurants()};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,n=t.selectedIndex,r=e[a].value,i=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,i,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},getLiveMap=function(){if(updateRestaurants(),!liveMap){var e=document.getElementById("static-map-img");e.parentNode.removeChild(e);self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),liveMap=!0}},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");if(e.forEach(function(e){t.append(createRestaurantHTML(e))}),initLoad){fetchNeighborhoods(),fetchCuisines();var a=DBHelper.staticImageForMapIndex(self.restaurants),n=document.getElementById("map"),r=document.createElement("img");r.id="static-map-img",r.alt="Static Google Maps image",r.style.width=n.clientWidth+"px",r.style.height=n.clientHeight+"px",r.src=a,r.addEventListener("click",function(){getLiveMap()}),n.appendChild(r),initLoad=!1}else addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li"),a=document.createElement("img");a.className="restaurant-img lazyload",a.setAttribute("data-src",DBHelper.smallImageUrlForRestaurant(e)+" 400w"),a.setAttribute("data-srcset",DBHelper.smallImageUrlForRestaurant(e)+" 400w, "+DBHelper.largeImageUrlForRestaurant(e)+" 800w"),a.setAttribute("data-sizes","auto"),a.title=""+e.name,a.alt=e.name+" in "+e.neighborhood+" - "+e.cuisine_type+" restaurant",t.appendChild(a);var n=document.createElement("div");n.className="header",t.appendChild(n);var r=document.createElement("h3");r.innerHTML=e.name,n.appendChild(r),createFavoriteButton(e,n);var i=document.createElement("p");i.innerHTML=e.neighborhood,t.appendChild(i);var o=document.createElement("p");o.innerHTML=e.address,t.appendChild(o);var s=document.createElement("p");s.className="restaurant-empty",t.appendChild(s);var l=document.createElement("a");return l.innerHTML="View Restaurant Details",l.href=DBHelper.urlForRestaurant(e),l.title=e.name+" - View Restaurant Details",l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.setAttribute("aria-label","View"+e.name+"Restaurant Details"),t.appendChild(l),t},createFavoriteButton=function(a,n){var r=document.createElement("button");r.type="button",r.className="favorite-button";var i=a.id,o=a.is_favorite,s=!0;changeFavoriteButton(o,r),r.addEventListener("click",function(){if(!navigator.onLine){o="false"===o?"true":"false";var e=(++offlineFavoriteCounter).toString();if(s){var t=document.createElement("div");t.classList.add("offline-favorite-label"),t.innerHTML='<i class="fas fa-exclamation-triangle"></i> Offline Mode - Favorite status will submit when network connection is reestablished',n.parentNode.insertBefore(t,n),s=!1}return DBHelper.updateFavorite(e,i,o),a.is_favorite=o,void changeFavoriteButton(o,r)}o="false"===o?"true":"false",DBHelper.updateFavorite(null,i,o),a.is_favorite=o,changeFavoriteButton(o,r)}),n.appendChild(r)},changeFavoriteButton=function(e,t){"true"===e?(t.title="Remove from favorites",t.setAttribute("aria-label","Remove from favorites"),t.classList.add("index-favorite-true"),t.classList.remove("index-favorite-false"),t.innerHTML='<i class="fas fa-heart"></i>'):(t.title="Add to favorites",t.setAttribute("aria-label","Add to favorites"),t.classList.add("index-favorite-false"),t.classList.remove("index-favorite-true"),t.innerHTML='<i class="far fa-heart"></i>')},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})};