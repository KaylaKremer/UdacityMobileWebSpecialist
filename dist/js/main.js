'use strict';

var restaurants = void 0,
    neighborhoods = void 0,
    cuisines = void 0,
    map = void 0;
var liveMap = false;
var initLoad = true;
var markers = [];
var offlineFavoriteCounter = 0;

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', function (event) {
	fetchNeighborhoods();
	fetchCuisines();
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
var fetchNeighborhoods = function fetchNeighborhoods() {
	DBHelper.fetchNeighborhoods(function (error, neighborhoods) {
		if (error) {
			// Got an error
			console.error(error);
		} else {
			self.neighborhoods = neighborhoods;
			fillNeighborhoodsHTML();
		}
	});
};

/**
 * Set neighborhoods HTML.
 */
var fillNeighborhoodsHTML = function fillNeighborhoodsHTML() {
	var neighborhoods = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.neighborhoods;

	var select = document.getElementById('neighborhoods-select');
	neighborhoods.forEach(function (neighborhood) {
		var option = document.createElement('option');
		option.innerHTML = neighborhood;
		option.value = neighborhood;
		select.append(option);
	});
};

/**
 * Fetch all cuisines and set their HTML.
 */
var fetchCuisines = function fetchCuisines() {
	DBHelper.fetchCuisines(function (error, cuisines) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			self.cuisines = cuisines;
			fillCuisinesHTML();
		}
	});
};

/**
 * Set cuisines HTML.
 */
var fillCuisinesHTML = function fillCuisinesHTML() {
	var cuisines = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.cuisines;

	var select = document.getElementById('cuisines-select');

	cuisines.forEach(function (cuisine) {
		var option = document.createElement('option');
		option.innerHTML = cuisine;
		option.value = cuisine;
		select.append(option);
	});
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
var updateRestaurants = function updateRestaurants() {
	var cSelect = document.getElementById('cuisines-select');
	var nSelect = document.getElementById('neighborhoods-select');

	var cIndex = cSelect.selectedIndex;
	var nIndex = nSelect.selectedIndex;

	var cuisine = cSelect[cIndex].value;
	var neighborhood = nSelect[nIndex].value;

	DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, function (error, restaurants) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			resetRestaurants(restaurants);
			fillRestaurantsHTML();
		}
	});
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
var resetRestaurants = function resetRestaurants(restaurants) {
	// Remove all restaurants
	self.restaurants = [];
	var ul = document.getElementById('restaurants-list');
	ul.innerHTML = '';

	// Remove all map markers
	self.markers.forEach(function (m) {
		return m.setMap(null);
	});
	self.markers = [];
	self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	updateRestaurants();
	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		var loc = {
			lat: 40.722216,
			lng: -73.987501
		};
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 12,
			center: loc,
			scrollwheel: false
		});
		liveMap = true;
	}
};

var fillRestaurantsHTML = function fillRestaurantsHTML() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	var ul = document.getElementById('restaurants-list');
	restaurants.forEach(function (restaurant) {
		ul.append(createRestaurantHTML(restaurant));
	});

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		fetchNeighborhoods();
		fetchCuisines();
		var staticMap = DBHelper.staticImageForMapIndex(self.restaurants);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap();
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkersToMap();
	}
};

/**
 * Create restaurant HTML.
 */
var createRestaurantHTML = function createRestaurantHTML(restaurant) {
	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var li = document.createElement('li');
	var image = document.createElement('img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';
	li.appendChild(image);

	/* Creates header div to hold name & favorite button. */
	var header = document.createElement('div');
	header.id = "header";
	li.appendChild(header);

	var name = document.createElement('h3');
	name.innerHTML = restaurant.name;
	header.appendChild(name);

	/* Creates favorite button */
	createFavoriteButton(restaurant, header);

	var neighborhood = document.createElement('p');
	neighborhood.innerHTML = restaurant.neighborhood;
	li.appendChild(neighborhood);

	var address = document.createElement('p');
	address.innerHTML = restaurant.address;
	li.appendChild(address);

	/* Creates empty element so flex grow can be applied and create space to vertically align View Details buttons. */
	var empty = document.createElement('p');
	empty.className = 'restaurant-empty';
	li.appendChild(empty);

	var more = document.createElement('a');
	more.innerHTML = 'View Restaurant Details';
	more.href = DBHelper.urlForRestaurant(restaurant);

	/* Dynamically sets title attribute. */
	more.title = restaurant.name + ' - View Restaurant Details';

	/* Sets ARIA attributes to each restaurant link. */
	more.setAttribute('role', 'button');
	more.setAttribute('tabindex', '0');
	more.setAttribute('aria-label', 'View' + restaurant.name + 'Restaurant Details');
	li.appendChild(more);

	return li;
};

/**
 * Creates a favorite button. When clicked, notifies user that restaurant favorite has been added or removed via visual cues and ARIA label changes. Also updates server and IndexedDB with favorite status of the restaurant. If user clicks on favorite button while offline, stores favorite status in local storage and creates an offline label to notify user favorite status will be updated when network connection is reestablished. 
 */
var createFavoriteButton = function createFavoriteButton(restaurant, header) {
	var favoriteButton = document.createElement('button');
	favoriteButton.type = 'button';
	favoriteButton.id = 'favorite-button';
	var restaurantId = restaurant.id;
	var isFavorite = restaurant.is_favorite;
	var noOfflineLabel = true;

	getFavoriteButtonClass(isFavorite, favoriteButton);

	favoriteButton.addEventListener('click', function () {
		if (!navigator.onLine) {
			if (isFavorite === 'false') {
				isFavorite = 'true';
			} else {
				isFavorite = 'false';
			}
			/* Creates unique id to reference favorite status in local storage. */
			offlineFavoriteCounter++;
			var favoriteId = offlineFavoriteCounter.toString();
			/* Make sure only one offline label is created no matter how many times user clicks on favorite button while offline */
			if (noOfflineLabel) {
				var offlineFavoriteLabel = document.createElement('div');
				offlineFavoriteLabel.classList.add('offline-favorite-label');
				offlineFavoriteLabel.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Offline Mode - Favorite status will submit when network connection is reestablished';
				header.parentNode.insertBefore(offlineFavoriteLabel, header);
				noOfflineLabel = false;
			}
			DBHelper.updateFavorite(favoriteId, restaurantId, isFavorite);
			restaurant.is_favorite = isFavorite;
			getFavoriteButtonClass(isFavorite, favoriteButton);
			return;
		}
		if (isFavorite === 'false') {
			isFavorite = 'true';
		} else {
			isFavorite = 'false';
		}
		DBHelper.updateFavorite(null, restaurantId, isFavorite);
		restaurant.is_favorite = isFavorite;
		getFavoriteButtonClass(isFavorite, favoriteButton);
	});
	header.appendChild(favoriteButton);
};

/**
 * Change favorite button to appear on or off with class change.
 */
var getFavoriteButtonClass = function getFavoriteButtonClass(isFavorite, favoriteButton) {
	if (isFavorite === 'true') {
		favoriteButton.title = 'Remove from favorites';
		favoriteButton.setAttribute('aria-label', 'Remove from favorites');
		favoriteButton.classList.add('index-favorite-true');
		favoriteButton.classList.remove('index-favorite-false');
		favoriteButton.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favoriteButton.title = 'Add to favorites';
		favoriteButton.setAttribute('aria-label', 'Add to favorites');
		favoriteButton.classList.add('index-favorite-false');
		favoriteButton.classList.remove('index-favorite-true');
		favoriteButton.innerHTML = '<i class="far fa-heart"></i>';
	}
};

/**
 * Add markers for current restaurants to the map.
 */
var addMarkersToMap = function addMarkersToMap() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	restaurants.forEach(function (restaurant) {
		// Add marker to the map
		var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
		google.maps.event.addListener(marker, 'click', function () {
			window.location.href = marker.url;
		});
		self.markers.push(marker);
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJsaXZlTWFwIiwiaW5pdExvYWQiLCJtYXJrZXJzIiwib2ZmbGluZUZhdm9yaXRlQ291bnRlciIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsIkRCSGVscGVyIiwiZXJyb3IiLCJjb25zb2xlIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJuZWlnaGJvcmhvb2QiLCJ2YWx1ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJjdWlzaW5lIiwid2luZG93IiwiaW5pdE1hcCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ1bCIsIm0iLCJzZXRNYXAiLCJnZXRMaXZlTWFwIiwic3RhdGljTWFwSW1nIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwibG9jIiwibGF0IiwibG5nIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJzY3JvbGx3aGVlbCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwicmVzdGF1cmFudCIsInN0YXRpY01hcCIsInN0YXRpY0ltYWdlRm9yTWFwSW5kZXgiLCJpZCIsImFsdCIsInN0eWxlIiwid2lkdGgiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNyYyIsImFwcGVuZENoaWxkIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNldEF0dHJpYnV0ZSIsInNtYWxsSW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwibGFyZ2VJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJ0aXRsZSIsIm5hbWUiLCJjdWlzaW5lX3R5cGUiLCJoZWFkZXIiLCJjcmVhdGVGYXZvcml0ZUJ1dHRvbiIsImFkZHJlc3MiLCJlbXB0eSIsIm1vcmUiLCJocmVmIiwidXJsRm9yUmVzdGF1cmFudCIsImZhdm9yaXRlQnV0dG9uIiwidHlwZSIsInJlc3RhdXJhbnRJZCIsImlzRmF2b3JpdGUiLCJpc19mYXZvcml0ZSIsIm5vT2ZmbGluZUxhYmVsIiwiZ2V0RmF2b3JpdGVCdXR0b25DbGFzcyIsIm5hdmlnYXRvciIsIm9uTGluZSIsImZhdm9yaXRlSWQiLCJ0b1N0cmluZyIsIm9mZmxpbmVGYXZvcml0ZUxhYmVsIiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5zZXJ0QmVmb3JlIiwidXBkYXRlRmF2b3JpdGUiLCJyZW1vdmUiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInVybCIsInB1c2giXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsb0JBQUo7QUFBQSxJQUNDQyxzQkFERDtBQUFBLElBRUNDLGlCQUZEO0FBQUEsSUFHQ0MsWUFIRDtBQUlBLElBQUlDLFVBQVUsS0FBZDtBQUNBLElBQUlDLFdBQVcsSUFBZjtBQUNBLElBQUlDLFVBQVUsRUFBZDtBQUNBLElBQUlDLHlCQUF5QixDQUE3Qjs7QUFFQTs7O0FBR0FDLFNBQVNDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxVQUFDQyxLQUFELEVBQVc7QUFDeERDO0FBQ0FDO0FBQ0EsQ0FIRDs7QUFLQTs7O0FBR0EsSUFBTUQscUJBQXFCLFNBQXJCQSxrQkFBcUIsR0FBTTtBQUNoQ0UsVUFBU0Ysa0JBQVQsQ0FBNEIsVUFBQ0csS0FBRCxFQUFRYixhQUFSLEVBQTBCO0FBQ3JELE1BQUlhLEtBQUosRUFB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U0FBbEJBLGVBQWtCLEdBQW9DO0FBQUEsS0FBbkNyRSxXQUFtQyx1RUFBckJnQixLQUFLaEIsV0FBZ0I7O0FBQzNEQSxhQUFZb0IsT0FBWixDQUFvQixzQkFBYztBQUNqQztBQUNBLE1BQU1tRixTQUFTMUYsU0FBUzJGLHNCQUFULENBQWdDL0MsVUFBaEMsRUFBNEN6QyxLQUFLYixHQUFqRCxDQUFmO0FBQ0ErQyxTQUFPQyxJQUFQLENBQVl6QyxLQUFaLENBQWtCK0YsV0FBbEIsQ0FBOEJGLE1BQTlCLEVBQXNDLE9BQXRDLEVBQStDLFlBQU07QUFDcEQxRSxVQUFPNkUsUUFBUCxDQUFnQnRCLElBQWhCLEdBQXVCbUIsT0FBT0ksR0FBOUI7QUFDQSxHQUZEO0FBR0EzRixPQUFLVixPQUFMLENBQWFzRyxJQUFiLENBQWtCTCxNQUFsQjtBQUNBLEVBUEQ7QUFRQSxDQVREIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudHMsXG5cdG5laWdoYm9yaG9vZHMsXG5cdGN1aXNpbmVzLFxuXHRtYXA7XG5sZXQgbGl2ZU1hcCA9IGZhbHNlO1xubGV0IGluaXRMb2FkID0gdHJ1ZTtcbmxldCBtYXJrZXJzID0gW107XG5sZXQgb2ZmbGluZUZhdm9yaXRlQ291bnRlciA9IDA7XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcblx0ZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG5cdGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuXHREQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XG5cdFx0aWYgKGVycm9yKSB7IFxuXHRcdFx0Ly8gR290IGFuIGVycm9yXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcblx0XHRcdGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXHRuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuXHRcdG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5jb25zdCBmZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xuXHREQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgXG5cdFx0XHQvLyBHb3QgYW4gZXJyb3IhXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuXHRcdFx0ZmlsbEN1aXNpbmVzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cblx0Y3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcblx0XHRvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuXHRcdHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG5cdHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59O1xuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuXHRjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXHRjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cblx0Y29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuXHRjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcblx0Y29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG5cdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuXHRcdFx0ZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xuY29uc3QgcmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuXHQvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG5cdHNlbGYucmVzdGF1cmFudHMgPSBbXTtcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuXHR1bC5pbm5lckhUTUwgPSAnJztcblxuXHQvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG5cdHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuXHRzZWxmLm1hcmtlcnMgPSBbXTtcblx0c2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cbi8qIElmIGEgbGl2ZSBtYXAgaXNuJ3QgYWxyZWFkeSBlbmFibGVkLCByZW1vdmVzIHRoZSBzdGF0aWMgbWFwIGltYWdlIGFuZCByZXBsYWNlcyBpdCB3aXRoIGEgbGl2ZSBHb29nbGUgTWFwLiAqL1xuY29uc3QgZ2V0TGl2ZU1hcCA9ICgpID0+IHtcblx0dXBkYXRlUmVzdGF1cmFudHMoKTtcblx0aWYobGl2ZU1hcCl7XG5cdFx0cmV0dXJuO1xuXHR9IGVsc2Uge1xuXHRcdGNvbnN0IHN0YXRpY01hcEltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0aWMtbWFwLWltZycpO1xuXHRcdHN0YXRpY01hcEltZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0YXRpY01hcEltZyk7XG5cdFx0bGV0IGxvYyA9IHtcblx0XHRcdGxhdDogNDAuNzIyMjE2LFxuXHRcdFx0bG5nOiAtNzMuOTg3NTAxXG5cdFx0fTtcblx0XHRzZWxmLm1hcCA9IG5ldyBnb29nbGVcblx0XHRcdC5tYXBzXG5cdFx0XHQuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuXHRcdFx0XHR6b29tOiAxMixcblx0XHRcdFx0Y2VudGVyOiBsb2MsXG5cdFx0XHRcdHNjcm9sbHdoZWVsOiBmYWxzZVxuXHRcdFx0fSk7XG5cdFx0bGl2ZU1hcCA9IHRydWU7XG5cdH1cbn07XG5cbmNvbnN0IGZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcblx0XHR1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuXHR9KTtcblx0XG5cdC8qIExvYWRzIGEgc3RhdGljIG1hcCBpbWFnZSBpZiBpdCdzIHRoZSBpbml0aWFsIHBhZ2UgbG9hZC4gQWRkcyBhIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHNvIHRoYXQgd2hlbiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIG1hcCwgaXQgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgbG9hZHMgYSBsaXZlIG1hcCBpbiBpdHMgcGxhY2UuICovXG5cdGlmIChpbml0TG9hZCl7XG5cdFx0ZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG5cdFx0ZmV0Y2hDdWlzaW5lcygpO1xuXHRcdGNvbnN0IHN0YXRpY01hcCA9IERCSGVscGVyLnN0YXRpY0ltYWdlRm9yTWFwSW5kZXgoc2VsZi5yZXN0YXVyYW50cyk7XG5cdFx0Y29uc3QgbWFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xuXHRcdGNvbnN0IHN0YXRpY01hcEltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRcdHN0YXRpY01hcEltZy5pZCA9ICdzdGF0aWMtbWFwLWltZyc7XG5cdFx0c3RhdGljTWFwSW1nLmFsdCA9ICdTdGF0aWMgR29vZ2xlIE1hcHMgaW1hZ2UnO1xuXHRcdHN0YXRpY01hcEltZy5zdHlsZS53aWR0aCA9IGAke21hcC5jbGllbnRXaWR0aH1weGA7XG5cdFx0c3RhdGljTWFwSW1nLnN0eWxlLmhlaWdodCA9IGAke21hcC5jbGllbnRIZWlnaHR9cHhgO1xuXHRcdHN0YXRpY01hcEltZy5zcmMgPSBzdGF0aWNNYXA7XG5cdFx0c3RhdGljTWFwSW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0Z2V0TGl2ZU1hcCgpO1xuXHRcdH0pO1xuXHRcdG1hcC5hcHBlbmRDaGlsZChzdGF0aWNNYXBJbWcpO1xuXHRcdGluaXRMb2FkID0gZmFsc2U7XG5cdH0gZWxzZSB7XG5cdFx0YWRkTWFya2Vyc1RvTWFwKCk7XG5cdH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuXHQvKiBMYXp5IGxvYWRzIHNtYWxsIG9yIGxhcmdlIHZlcnNpb24gb2YgcmVzdGF1cmFudCBpbWFnZSBiYXNlZCBvbiBkYXRhLXNyY3NldCBhbmQgYXV0byBkYXRhLXNpemVzLiBBbHNvIGR5bmFtaWNhbGx5IHNldHMgYWx0IGFuZCB0aXRsZSB0ZXh0IG9mIHRoZSBpbWFnZS4gKi9cblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOyBcblx0Y29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nIGxhenlsb2FkJztcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIGAke0RCSGVscGVyLnNtYWxsSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA0MDB3YCk7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLGAke0RCSGVscGVyLnNtYWxsSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA0MDB3LCAke0RCSGVscGVyLmxhcmdlSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA4MDB3YCk7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zaXplcycsICdhdXRvJyk7XG5cdGltYWdlLnRpdGxlID0gYCR7cmVzdGF1cmFudC5uYW1lfWA7XG5cdGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0gaW4gJHtyZXN0YXVyYW50Lm5laWdoYm9yaG9vZH0gLSAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSByZXN0YXVyYW50YDtcblx0bGkuYXBwZW5kQ2hpbGQoaW1hZ2UpO1xuXG5cdC8qIENyZWF0ZXMgaGVhZGVyIGRpdiB0byBob2xkIG5hbWUgJiBmYXZvcml0ZSBidXR0b24uICovXG5cdGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRoZWFkZXIuaWQgPSBcImhlYWRlclwiO1xuXHRsaS5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuXHRuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblx0aGVhZGVyLmFwcGVuZENoaWxkKG5hbWUpO1xuXG5cdC8qIENyZWF0ZXMgZmF2b3JpdGUgYnV0dG9uICovXG5cdGNyZWF0ZUZhdm9yaXRlQnV0dG9uKHJlc3RhdXJhbnQsIGhlYWRlcik7XG5cblx0Y29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG5cdGxpLmFwcGVuZENoaWxkKG5laWdoYm9yaG9vZCk7XG5cblx0Y29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0YWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cdGxpLmFwcGVuZENoaWxkKGFkZHJlc3MpO1xuXG5cdC8qIENyZWF0ZXMgZW1wdHkgZWxlbWVudCBzbyBmbGV4IGdyb3cgY2FuIGJlIGFwcGxpZWQgYW5kIGNyZWF0ZSBzcGFjZSB0byB2ZXJ0aWNhbGx5IGFsaWduIFZpZXcgRGV0YWlscyBidXR0b25zLiAqL1xuXHRjb25zdCBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0ZW1wdHkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtZW1wdHknO1xuXHRsaS5hcHBlbmRDaGlsZChlbXB0eSk7XG5cblx0Y29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcblx0bW9yZS5pbm5lckhUTUwgPSAnVmlldyBSZXN0YXVyYW50IERldGFpbHMnO1xuXHRtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuXG5cdC8qIER5bmFtaWNhbGx5IHNldHMgdGl0bGUgYXR0cmlidXRlLiAqL1xuXHRtb3JlLnRpdGxlID0gYCR7cmVzdGF1cmFudC5uYW1lfSAtIFZpZXcgUmVzdGF1cmFudCBEZXRhaWxzYDtcblxuXHQvKiBTZXRzIEFSSUEgYXR0cmlidXRlcyB0byBlYWNoIHJlc3RhdXJhbnQgbGluay4gKi9cblx0bW9yZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG5cdG1vcmUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cdG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1ZpZXcnICsgcmVzdGF1cmFudC5uYW1lICsgJ1Jlc3RhdXJhbnQgRGV0YWlscycpO1xuXHRsaS5hcHBlbmRDaGlsZChtb3JlKTtcblxuXHRyZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmYXZvcml0ZSBidXR0b24uIFdoZW4gY2xpY2tlZCwgbm90aWZpZXMgdXNlciB0aGF0IHJlc3RhdXJhbnQgZmF2b3JpdGUgaGFzIGJlZW4gYWRkZWQgb3IgcmVtb3ZlZCB2aWEgdmlzdWFsIGN1ZXMgYW5kIEFSSUEgbGFiZWwgY2hhbmdlcy4gQWxzbyB1cGRhdGVzIHNlcnZlciBhbmQgSW5kZXhlZERCIHdpdGggZmF2b3JpdGUgc3RhdHVzIG9mIHRoZSByZXN0YXVyYW50LiBJZiB1c2VyIGNsaWNrcyBvbiBmYXZvcml0ZSBidXR0b24gd2hpbGUgb2ZmbGluZSwgc3RvcmVzIGZhdm9yaXRlIHN0YXR1cyBpbiBsb2NhbCBzdG9yYWdlIGFuZCBjcmVhdGVzIGFuIG9mZmxpbmUgbGFiZWwgdG8gbm90aWZ5IHVzZXIgZmF2b3JpdGUgc3RhdHVzIHdpbGwgYmUgdXBkYXRlZCB3aGVuIG5ldHdvcmsgY29ubmVjdGlvbiBpcyByZWVzdGFibGlzaGVkLiBcbiAqL1xuY29uc3QgY3JlYXRlRmF2b3JpdGVCdXR0b24gPSAocmVzdGF1cmFudCwgaGVhZGVyKSA9PiB7XG5cdGNvbnN0IGZhdm9yaXRlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cdGZhdm9yaXRlQnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcblx0ZmF2b3JpdGVCdXR0b24uaWQgPSAnZmF2b3JpdGUtYnV0dG9uJztcblx0Y29uc3QgcmVzdGF1cmFudElkID0gcmVzdGF1cmFudC5pZDtcblx0bGV0IGlzRmF2b3JpdGUgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuXHRsZXQgbm9PZmZsaW5lTGFiZWwgPSB0cnVlO1xuXG5cdGdldEZhdm9yaXRlQnV0dG9uQ2xhc3MoaXNGYXZvcml0ZSwgZmF2b3JpdGVCdXR0b24pO1xuXG5cdGZhdm9yaXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKXtcblx0XHRcdGlmIChpc0Zhdm9yaXRlID09PSAnZmFsc2UnKXtcblx0XHRcdFx0aXNGYXZvcml0ZSA9ICd0cnVlJztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlzRmF2b3JpdGUgPSAnZmFsc2UnO1xuXHRcdFx0fVxuXHRcdFx0LyogQ3JlYXRlcyB1bmlxdWUgaWQgdG8gcmVmZXJlbmNlIGZhdm9yaXRlIHN0YXR1cyBpbiBsb2NhbCBzdG9yYWdlLiAqL1xuXHRcdFx0b2ZmbGluZUZhdm9yaXRlQ291bnRlcisrO1xuXHRcdFx0bGV0IGZhdm9yaXRlSWQgPSBvZmZsaW5lRmF2b3JpdGVDb3VudGVyLnRvU3RyaW5nKCk7XG5cdFx0XHQvKiBNYWtlIHN1cmUgb25seSBvbmUgb2ZmbGluZSBsYWJlbCBpcyBjcmVhdGVkIG5vIG1hdHRlciBob3cgbWFueSB0aW1lcyB1c2VyIGNsaWNrcyBvbiBmYXZvcml0ZSBidXR0b24gd2hpbGUgb2ZmbGluZSAqL1xuXHRcdFx0aWYobm9PZmZsaW5lTGFiZWwpe1xuXHRcdFx0XHRjb25zdCBvZmZsaW5lRmF2b3JpdGVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRvZmZsaW5lRmF2b3JpdGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdvZmZsaW5lLWZhdm9yaXRlLWxhYmVsJyk7XG5cdFx0XHRcdG9mZmxpbmVGYXZvcml0ZUxhYmVsLmlubmVySFRNTCA9IGA8aSBjbGFzcz1cImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZVwiPjwvaT4gT2ZmbGluZSBNb2RlIC0gRmF2b3JpdGUgc3RhdHVzIHdpbGwgc3VibWl0IHdoZW4gbmV0d29yayBjb25uZWN0aW9uIGlzIHJlZXN0YWJsaXNoZWRgO1xuXHRcdFx0XHRoZWFkZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUob2ZmbGluZUZhdm9yaXRlTGFiZWwsIGhlYWRlcik7XG5cdFx0XHRcdG5vT2ZmbGluZUxhYmVsID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHREQkhlbHBlci51cGRhdGVGYXZvcml0ZShmYXZvcml0ZUlkLCByZXN0YXVyYW50SWQsIGlzRmF2b3JpdGUpO1xuXHRcdFx0cmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG5cdFx0XHRnZXRGYXZvcml0ZUJ1dHRvbkNsYXNzKGlzRmF2b3JpdGUsIGZhdm9yaXRlQnV0dG9uKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0aWYgKGlzRmF2b3JpdGUgPT09ICdmYWxzZScpe1xuXHRcdFx0aXNGYXZvcml0ZSA9ICd0cnVlJztcblx0XHR9IGVsc2Uge1xuXHRcdFx0aXNGYXZvcml0ZSA9ICdmYWxzZSc7XG5cdFx0fSBcblx0XHREQkhlbHBlci51cGRhdGVGYXZvcml0ZShudWxsLCByZXN0YXVyYW50SWQsIGlzRmF2b3JpdGUpO1xuXHRcdHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBpc0Zhdm9yaXRlO1xuXHRcdGdldEZhdm9yaXRlQnV0dG9uQ2xhc3MoaXNGYXZvcml0ZSwgZmF2b3JpdGVCdXR0b24pO1xuXHR9KTtcblx0aGVhZGVyLmFwcGVuZENoaWxkKGZhdm9yaXRlQnV0dG9uKTtcbn07XG5cbi8qKlxuICogQ2hhbmdlIGZhdm9yaXRlIGJ1dHRvbiB0byBhcHBlYXIgb24gb3Igb2ZmIHdpdGggY2xhc3MgY2hhbmdlLlxuICovXG5jb25zdCBnZXRGYXZvcml0ZUJ1dHRvbkNsYXNzID0gKGlzRmF2b3JpdGUsIGZhdm9yaXRlQnV0dG9uKSA9PiB7XG5cdGlmIChpc0Zhdm9yaXRlID09PSAndHJ1ZScpe1xuXHRcdGZhdm9yaXRlQnV0dG9uLnRpdGxlID0gJ1JlbW92ZSBmcm9tIGZhdm9yaXRlcyc7XG5cdFx0ZmF2b3JpdGVCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1JlbW92ZSBmcm9tIGZhdm9yaXRlcycpO1xuXHRcdGZhdm9yaXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2luZGV4LWZhdm9yaXRlLXRydWUnKTtcblx0XHRmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdpbmRleC1mYXZvcml0ZS1mYWxzZScpO1xuXHRcdGZhdm9yaXRlQnV0dG9uLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhcyBmYS1oZWFydFwiPjwvaT4nO1xuXHR9IGVsc2Uge1xuXHRcdGZhdm9yaXRlQnV0dG9uLnRpdGxlID0gJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRcdGZhdm9yaXRlQnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdBZGQgdG8gZmF2b3JpdGVzJyk7XG5cdFx0ZmF2b3JpdGVCdXR0b24uY2xhc3NMaXN0LmFkZCgnaW5kZXgtZmF2b3JpdGUtZmFsc2UnKTtcblx0XHRmYXZvcml0ZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdpbmRleC1mYXZvcml0ZS10cnVlJyk7XG5cdFx0ZmF2b3JpdGVCdXR0b24uaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmFyIGZhLWhlYXJ0XCI+PC9pPic7XG5cdH1cbn07XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuXHRcdC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuXHRcdGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuXHRcdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuXHRcdH0pO1xuXHRcdHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG5cdH0pO1xufTtcblxuIl19
