'use strict';

var restaurants = void 0,
    neighborhoods = void 0,
    cuisines = void 0;
var map = void 0;
var markers = [];

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', function (event) {
	fetchNeighborhoods();
	fetchCuisines();
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
fetchNeighborhoods = function fetchNeighborhoods() {
	DBHelper.fetchNeighborhoods(function (error, neighborhoods) {
		if (error) {
			// Got an error
			console.error(error);
		} else {
			self.neighborhoods = neighborhoods;
			fillNeighborhoodsHTML();
		}
	});
};

/**
 * Set neighborhoods HTML.
 */
fillNeighborhoodsHTML = function fillNeighborhoodsHTML() {
	var neighborhoods = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.neighborhoods;

	var select = document.getElementById('neighborhoods-select');
	neighborhoods.forEach(function (neighborhood) {
		var option = document.createElement('option');
		option.innerHTML = neighborhood;
		option.value = neighborhood;
		select.append(option);
	});
};

/**
 * Fetch all cuisines and set their HTML.
 */
fetchCuisines = function fetchCuisines() {
	DBHelper.fetchCuisines(function (error, cuisines) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			self.cuisines = cuisines;
			fillCuisinesHTML();
		}
	});
};

/**
 * Set cuisines HTML.
 */
fillCuisinesHTML = function fillCuisinesHTML() {
	var cuisines = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.cuisines;

	var select = document.getElementById('cuisines-select');

	cuisines.forEach(function (cuisine) {
		var option = document.createElement('option');
		option.innerHTML = cuisine;
		option.value = cuisine;
		select.append(option);
	});
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	var loc = {
		lat: 40.722216,
		lng: -73.987501
	};
	self.map = new google.maps.Map(document.getElementById('map'), {
		zoom: 12,
		center: loc,
		scrollwheel: false
	});
	updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
updateRestaurants = function updateRestaurants() {
	var cSelect = document.getElementById('cuisines-select');
	var nSelect = document.getElementById('neighborhoods-select');

	var cIndex = cSelect.selectedIndex;
	var nIndex = nSelect.selectedIndex;

	var cuisine = cSelect[cIndex].value;
	var neighborhood = nSelect[nIndex].value;

	DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, function (error, restaurants) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			resetRestaurants(restaurants);
			fillRestaurantsHTML();
		}
	});
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
resetRestaurants = function resetRestaurants(restaurants) {
	// Remove all restaurants
	self.restaurants = [];
	var ul = document.getElementById('restaurants-list');
	ul.innerHTML = '';

	// Remove all map markers
	self.markers.forEach(function (m) {
		return m.setMap(null);
	});
	self.markers = [];
	self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */
fillRestaurantsHTML = function fillRestaurantsHTML() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	var ul = document.getElementById('restaurants-list');
	restaurants.forEach(function (restaurant) {
		ul.append(createRestaurantHTML(restaurant));
	});
	addMarkersToMap();
};

/**
 * Create restaurant HTML.
 */
createRestaurantHTML = function createRestaurantHTML(restaurant) {
	var li = document.createElement('li');
	// Loads small or large version of restaurant image based on srcset and sizes. Also dynamically sets alt and title text of the image. 
	var image = document.createElement('img');
	image.className = 'restaurant-img';
	image.src = DBHelper.largeImageUrlForRestaurant(restaurant);
	image.srcset = DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w';
	image.sizes = '50vw';
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';
	li.append(image);

	var name = document.createElement('h3');
	name.innerHTML = restaurant.name;
	li.append(name);

	var neighborhood = document.createElement('p');
	neighborhood.innerHTML = restaurant.neighborhood;
	li.append(neighborhood);

	var address = document.createElement('p');
	address.innerHTML = restaurant.address;
	li.append(address);

	//Create empty element so flex grow can be applied and create space to vertically align View Details buttons.
	var empty = document.createElement('p');
	empty.className = 'restaurant-empty';
	li.append(empty);

	var more = document.createElement('a');
	more.innerHTML = 'View Restaurant Details';
	more.href = DBHelper.urlForRestaurant(restaurant);
	//Dynamically set title attribute
	more.title = restaurant.name + ' - View Restaurant Details';
	//Set ARIA attributes to each restaurant link
	more.setAttribute('role', 'button');
	more.setAttribute('tabindex', '0');
	more.setAttribute('aria-label', 'View' + restaurant.name + 'Restaurant Details');
	li.append(more);

	return li;
};

/**
 * Add markers for current restaurants to the map.
 */
addMarkersToMap = function addMarkersToMap() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	restaurants.forEach(function (restaurant) {
		// Add marker to the map
		var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
		google.maps.event.addListener(marker, 'click', function () {
			window.location.href = marker.url;
		});
		self.markers.push(marker);
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJtYXJrZXJzIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiREJIZWxwZXIiLCJlcnJvciIsImNvbnNvbGUiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JFYWNoIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsIm5laWdoYm9yaG9vZCIsInZhbHVlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJ3aW5kb3ciLCJpbml0TWFwIiwibG9jIiwibGF0IiwibG5nIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ1bCIsIm0iLCJzZXRNYXAiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsInJlc3RhdXJhbnQiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwibGFyZ2VJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJzcmNzZXQiLCJzbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNpemVzIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwiY3Vpc2luZV90eXBlIiwiYWRkcmVzcyIsImVtcHR5IiwibW9yZSIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50Iiwic2V0QXR0cmlidXRlIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJ1cmwiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLG9CQUFKO0FBQUEsSUFDQ0Msc0JBREQ7QUFBQSxJQUVDQyxpQkFGRDtBQUdBLElBQUlDLFlBQUo7QUFDQSxJQUFJQyxVQUFVLEVBQWQ7O0FBRUE7OztBQUdBQyxTQUFTQyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsVUFBQ0MsS0FBRCxFQUFXO0FBQ3hEQztBQUNBQztBQUNBLENBSEQ7O0FBS0E7OztBQUdBRCxxQkFBcUIsOEJBQU07QUFDMUJFLFVBQVNGLGtCQUFULENBQTRCLFVBQUNHLEtBQUQsRUFBUVYsYUFBUixFQUEwQjtBQUNyRCxNQUFJVSxLQUFKLEVBQVc7QUFBRTtBQUNaQyxXQUFRRCxLQUFSLENBQWNBLEtBQWQ7QUFDQSxHQUZELE1BRU87QUFDTkUsUUFBS1osYUFBTCxHQUFxQkEsYUFBckI7QUFDQWE7QUFDQTtBQUNELEVBUEQ7QUFRQSxDQVREOztBQVdBOzs7QUFHQUEsd0JBQXdCLGlDQUF3QztBQUFBLEtBQXZDYixhQUF1Qyx1RUFBdkJZLEtBQUtaLGFBQWtCOztBQUMvRCxLQUFNYyxTQUFTVixTQUFTVyxjQUFULENBQXdCLHNCQUF4QixDQUFmO0FBQ0FmLGVBQWNnQixPQUFkLENBQXNCLHdCQUFnQjtBQUNyQyxNQUFNQyxTQUFTYixTQUFTYyxhQUFULENBQXVCLFFBQXZCLENBQWY7QUFDQUQsU0FBT0UsU0FBUCxHQUFtQkMsWUFBbkI7QUFDQUgsU0FBT0ksS0FBUCxHQUFlRCxZQUFmO0FBQ0FOLFNBQU9RLE1BQVAsQ0FBY0wsTUFBZDtBQUNBLEVBTEQ7QUFNQSxDQVJEOztBQVVBOzs7QUFHQVQsZ0JBQWdCLHlCQUFNO0FBQ3JCQyxVQUFTRCxhQUFULENBQXVCLFVBQUNFLEtBQUQsRUFBUVQsUUFBUixFQUFxQjtBQUMzQyxNQUFJUyxLQUFKLEVBQVc7QUFBRTtBQUNaQyxXQUFRRCxLQUFSLENBQWNBLEtBQWQ7QUFD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QUwsR0FBWXpELFNBQVMwRCxnQkFBVCxDQUEwQmxCLFVBQTFCLENBQVo7QUFDQTtBQUNBZ0IsTUFBS04sS0FBTCxHQUFnQlYsV0FBV1csSUFBM0I7QUFDQTtBQUNBSyxNQUFLRyxZQUFMLENBQWtCLE1BQWxCLEVBQTBCLFFBQTFCO0FBQ0FILE1BQUtHLFlBQUwsQ0FBa0IsVUFBbEIsRUFBOEIsR0FBOUI7QUFDQUgsTUFBS0csWUFBTCxDQUFrQixZQUFsQixFQUFnQyxTQUFTbkIsV0FBV1csSUFBcEIsR0FBMkIsb0JBQTNEO0FBQ0FULElBQUc3QixNQUFILENBQVUyQyxJQUFWOztBQUVBLFFBQU9kLEVBQVA7QUFDQSxDQXpDRDs7QUEyQ0E7OztBQUdBRCxrQkFBa0IsMkJBQW9DO0FBQUEsS0FBbkNuRCxXQUFtQyx1RUFBckJhLEtBQUtiLFdBQWdCOztBQUNyREEsYUFBWWlCLE9BQVosQ0FBb0Isc0JBQWM7QUFDakM7QUFDQSxNQUFNcUQsU0FBUzVELFNBQVM2RCxzQkFBVCxDQUFnQ3JCLFVBQWhDLEVBQTRDckMsS0FBS1YsR0FBakQsQ0FBZjtBQUNBNEIsU0FBT0MsSUFBUCxDQUFZekIsS0FBWixDQUFrQmlFLFdBQWxCLENBQThCRixNQUE5QixFQUFzQyxPQUF0QyxFQUErQyxZQUFNO0FBQ3BENUMsVUFBTytDLFFBQVAsQ0FBZ0JOLElBQWhCLEdBQXVCRyxPQUFPSSxHQUE5QjtBQUNBLEdBRkQ7QUFHQTdELE9BQUtULE9BQUwsQ0FBYXVFLElBQWIsQ0FBa0JMLE1BQWxCO0FBQ0EsRUFQRDtBQVFBLENBVEQiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50cyxcblx0bmVpZ2hib3Job29kcyxcblx0Y3Vpc2luZXM7XG5sZXQgbWFwO1xubGV0IG1hcmtlcnMgPSBbXTtcblxuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuXHRmZXRjaE5laWdoYm9yaG9vZHMoKTtcblx0ZmV0Y2hDdWlzaW5lcygpO1xufSk7XG5cbi8qKlxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG5cdERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcblx0XHRcdGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXHRuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuXHRcdG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xuXHREQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcblx0XHRcdGZpbGxDdWlzaW5lc0hUTUwoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG5cdGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG5cdFx0b3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XG5cdFx0b3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuXHRsZXQgbG9jID0ge1xuXHRcdGxhdDogNDAuNzIyMjE2LFxuXHRcdGxuZzogLTczLjk4NzUwMVxuXHR9O1xuXHRzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG5cdFx0em9vbTogMTIsXG5cdFx0Y2VudGVyOiBsb2MsXG5cdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXG5cdH0pO1xuXHR1cGRhdGVSZXN0YXVyYW50cygpO1xufTtcblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcblx0Y29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcblx0Y29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG5cdGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcblx0Y29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG5cdGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuXHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcblx0XHRcdGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcblx0Ly8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuXHRzZWxmLnJlc3RhdXJhbnRzID0gW107XG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcblx0dWwuaW5uZXJIVE1MID0gJyc7XG5cblx0Ly8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuXHRzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcblx0c2VsZi5tYXJrZXJzID0gW107XG5cdHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuXHRcdHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG5cdH0pO1xuXHRhZGRNYXJrZXJzVG9NYXAoKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cdC8vIExvYWRzIHNtYWxsIG9yIGxhcmdlIHZlcnNpb24gb2YgcmVzdGF1cmFudCBpbWFnZSBiYXNlZCBvbiBzcmNzZXQgYW5kIHNpemVzLiBBbHNvIGR5bmFtaWNhbGx5IHNldHMgYWx0IGFuZCB0aXRsZSB0ZXh0IG9mIHRoZSBpbWFnZS4gXG5cdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG5cdGltYWdlLnNyYyA9IERCSGVscGVyLmxhcmdlSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuXHRpbWFnZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5zbWFsbEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gNDAwdywgJHtEQkhlbHBlci5sYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0gODAwd2A7XG5cdGltYWdlLnNpemVzID0gJzUwdncnO1xuXHRpbWFnZS50aXRsZSA9IGAke3Jlc3RhdXJhbnQubmFtZX1gO1xuXHRpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IGluICR7cmVzdGF1cmFudC5uZWlnaGJvcmhvb2R9IC0gJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gcmVzdGF1cmFudGA7XG5cdGxpLmFwcGVuZChpbWFnZSk7XG5cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXHRsaS5hcHBlbmQobmFtZSk7XG5cblx0Y29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG5cdGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG5cdGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXHRsaS5hcHBlbmQoYWRkcmVzcyk7XG5cblx0Ly9DcmVhdGUgZW1wdHkgZWxlbWVudCBzbyBmbGV4IGdyb3cgY2FuIGJlIGFwcGxpZWQgYW5kIGNyZWF0ZSBzcGFjZSB0byB2ZXJ0aWNhbGx5IGFsaWduIFZpZXcgRGV0YWlscyBidXR0b25zLlxuXHRjb25zdCBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0ZW1wdHkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtZW1wdHknO1xuXHRsaS5hcHBlbmQoZW1wdHkpO1xuXG5cdGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgUmVzdGF1cmFudCBEZXRhaWxzJztcblx0bW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblx0Ly9EeW5hbWljYWxseSBzZXQgdGl0bGUgYXR0cmlidXRlXG5cdG1vcmUudGl0bGUgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IC0gVmlldyBSZXN0YXVyYW50IERldGFpbHNgO1xuXHQvL1NldCBBUklBIGF0dHJpYnV0ZXMgdG8gZWFjaCByZXN0YXVyYW50IGxpbmtcblx0bW9yZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG5cdG1vcmUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cdG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1ZpZXcnICsgcmVzdGF1cmFudC5uYW1lICsgJ1Jlc3RhdXJhbnQgRGV0YWlscycpO1xuXHRsaS5hcHBlbmQobW9yZSk7XG5cblx0cmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG5cdHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0Ly8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG5cdFx0Y29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XG5cdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmw7XG5cdFx0fSk7XG5cdFx0c2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcblx0fSk7XG59O1xuIl19
