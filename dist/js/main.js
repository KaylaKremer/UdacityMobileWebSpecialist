'use strict';

var restaurants = void 0,
    neighborhoods = void 0,
    cuisines = void 0,
    map = void 0;
var liveMap = false;
var initLoad = true;
var markers = [];

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', function (event) {
	fetchNeighborhoods();
	fetchCuisines();
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
var fetchNeighborhoods = function fetchNeighborhoods() {
	DBHelper.fetchNeighborhoods(function (error, neighborhoods) {
		if (error) {
			// Got an error
			console.error(error);
		} else {
			self.neighborhoods = neighborhoods;
			fillNeighborhoodsHTML();
		}
	});
};

/**
 * Set neighborhoods HTML.
 */
var fillNeighborhoodsHTML = function fillNeighborhoodsHTML() {
	var neighborhoods = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.neighborhoods;

	var select = document.getElementById('neighborhoods-select');
	neighborhoods.forEach(function (neighborhood) {
		var option = document.createElement('option');
		option.innerHTML = neighborhood;
		option.value = neighborhood;
		select.append(option);
	});
};

/**
 * Fetch all cuisines and set their HTML.
 */
var fetchCuisines = function fetchCuisines() {
	DBHelper.fetchCuisines(function (error, cuisines) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			self.cuisines = cuisines;
			fillCuisinesHTML();
		}
	});
};

/**
 * Set cuisines HTML.
 */
var fillCuisinesHTML = function fillCuisinesHTML() {
	var cuisines = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.cuisines;

	var select = document.getElementById('cuisines-select');

	cuisines.forEach(function (cuisine) {
		var option = document.createElement('option');
		option.innerHTML = cuisine;
		option.value = cuisine;
		select.append(option);
	});
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = function () {
	updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
var updateRestaurants = function updateRestaurants() {
	var cSelect = document.getElementById('cuisines-select');
	var nSelect = document.getElementById('neighborhoods-select');

	var cIndex = cSelect.selectedIndex;
	var nIndex = nSelect.selectedIndex;

	var cuisine = cSelect[cIndex].value;
	var neighborhood = nSelect[nIndex].value;

	DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, function (error, restaurants) {
		if (error) {
			// Got an error!
			console.error(error);
		} else {
			resetRestaurants(restaurants);
			fillRestaurantsHTML();
		}
	});
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
var resetRestaurants = function resetRestaurants(restaurants) {
	// Remove all restaurants
	self.restaurants = [];
	var ul = document.getElementById('restaurants-list');
	ul.innerHTML = '';

	// Remove all map markers
	self.markers.forEach(function (m) {
		return m.setMap(null);
	});
	self.markers = [];
	self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */

/* If a live map isn't already enabled, removes the static map image and replaces it with a live Google Map. */
var getLiveMap = function getLiveMap() {
	updateRestaurants();
	if (liveMap) {
		return;
	} else {
		var staticMapImg = document.getElementById('static-map-img');
		staticMapImg.parentNode.removeChild(staticMapImg);
		var loc = {
			lat: 40.722216,
			lng: -73.987501
		};
		self.map = new google.maps.Map(document.getElementById('map'), {
			zoom: 12,
			center: loc,
			scrollwheel: false
		});
		liveMap = true;
	}
};

var fillRestaurantsHTML = function fillRestaurantsHTML() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	var ul = document.getElementById('restaurants-list');
	restaurants.forEach(function (restaurant) {
		ul.append(createRestaurantHTML(restaurant));
	});

	/* Loads a static map image if it's the initial page load. Adds a click event listener so that when the user clicks on the map, it removes the static map image and loads a live map in its place. */
	if (initLoad) {
		fetchNeighborhoods();
		fetchCuisines();
		var staticMap = DBHelper.staticImageForMapIndex(self.restaurants);
		var _map = document.getElementById('map');
		var staticMapImg = document.createElement('img');
		staticMapImg.id = 'static-map-img';
		staticMapImg.alt = 'Static Google Maps image';
		staticMapImg.style.width = _map.clientWidth + 'px';
		staticMapImg.style.height = _map.clientHeight + 'px';
		staticMapImg.src = staticMap;
		staticMapImg.addEventListener('click', function () {
			getLiveMap();
		});
		_map.appendChild(staticMapImg);
		initLoad = false;
	} else {
		addMarkersToMap();
	}
};

/**
 * Create restaurant HTML.
 */
var createRestaurantHTML = function createRestaurantHTML(restaurant) {
	/* Lazy loads small or large version of restaurant image based on data-srcset and auto data-sizes. Also dynamically sets alt and title text of the image. */
	var li = document.createElement('li');
	var image = document.createElement('img');
	image.className = 'restaurant-img lazyload';
	image.setAttribute('data-src', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w');
	image.setAttribute('data-srcset', DBHelper.smallImageUrlForRestaurant(restaurant) + ' 400w, ' + DBHelper.largeImageUrlForRestaurant(restaurant) + ' 800w');
	image.setAttribute('data-sizes', 'auto');
	image.title = '' + restaurant.name;
	image.alt = restaurant.name + ' in ' + restaurant.neighborhood + ' - ' + restaurant.cuisine_type + ' restaurant';
	li.append(image);

	/* Creates header div to hold name & favorite button. */
	var header = document.createElement('div');
	header.id = "header";
	li.append(header);

	var name = document.createElement('h3');
	name.innerHTML = restaurant.name;
	header.append(name);

	/* Creates a dynamic favorite button. When clicked, notifies user that restaurant favorite has been added or removed via visual cues and ARIA label changes. Also updates IDB with favorite status of the restaurant. */
	var favorite = document.createElement('button');
	favorite.type = 'button';
	favorite.id = 'favorite-button';
	favorite.title = 'Add to favorites';
	favorite.setAttribute('aria-label', 'Add to favorites');
	getFavoriteClass(restaurant, favorite);
	favorite.addEventListener('click', function () {
		var isFavorite = void 0;
		if (restaurant.is_favorite === 'false') {
			isFavorite = 'true';
			favorite.title = 'Remove from favorites';
			favorite.setAttribute('aria-label', 'Remove from favorites');
		} else {
			isFavorite = 'false';
			favorite.title = 'Add to favorites';
			favorite.setAttribute('aria-label', 'Add to favorites');
		}
		var restaurantId = restaurant.id;
		DBHelper.updateFavorite(restaurantId, isFavorite);
		restaurant.is_favorite = isFavorite;
		getFavoriteClass(restaurant, favorite);
	});
	header.append(favorite);

	var neighborhood = document.createElement('p');
	neighborhood.innerHTML = restaurant.neighborhood;
	li.append(neighborhood);

	var address = document.createElement('p');
	address.innerHTML = restaurant.address;
	li.append(address);

	/* Creates empty element so flex grow can be applied and create space to vertically align View Details buttons. */
	var empty = document.createElement('p');
	empty.className = 'restaurant-empty';
	li.append(empty);

	var more = document.createElement('a');
	more.innerHTML = 'View Restaurant Details';
	more.href = DBHelper.urlForRestaurant(restaurant);

	/* Dynamically sets title attribute. */
	more.title = restaurant.name + ' - View Restaurant Details';

	/* Sets ARIA attributes to each restaurant link. */
	more.setAttribute('role', 'button');
	more.setAttribute('tabindex', '0');
	more.setAttribute('aria-label', 'View' + restaurant.name + 'Restaurant Details');
	li.append(more);

	return li;
};

/**
 * Change favorite icon to appear on or off with class change.
 */
var getFavoriteClass = function getFavoriteClass(restaurant, favorite) {
	if (restaurant.is_favorite === 'true') {
		favorite.classList.add('index-favorite-true');
		favorite.classList.remove('index-favorite-false');
		favorite.innerHTML = '<i class="fas fa-heart"></i>';
	} else {
		favorite.classList.add('index-favorite-false');
		favorite.classList.remove('index-favorite-true');
		favorite.innerHTML = '<i class="far fa-heart"></i>';
	}
};

/**
 * Add markers for current restaurants to the map.
 */
var addMarkersToMap = function addMarkersToMap() {
	var restaurants = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurants;

	restaurants.forEach(function (restaurant) {
		// Add marker to the map
		var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
		google.maps.event.addListener(marker, 'click', function () {
			window.location.href = marker.url;
		});
		self.markers.push(marker);
	});
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJsaXZlTWFwIiwiaW5pdExvYWQiLCJtYXJrZXJzIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiREJIZWxwZXIiLCJlcnJvciIsImNvbnNvbGUiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JFYWNoIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsIm5laWdoYm9yaG9vZCIsInZhbHVlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJ3aW5kb3ciLCJpbml0TWFwIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwibSIsInNldE1hcCIsImdldExpdmVNYXAiLCJzdGF0aWNNYXBJbWciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJsb2MiLCJsYXQiLCJsbmciLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJyZXN0YXVyYW50Iiwic3RhdGljTWFwIiwic3RhdGljSW1hZ2VGb3JNYXBJbmRleCIsImlkIiwiYWx0Iiwic3R5bGUiLCJ3aWR0aCIsImNsaWVudFdpZHRoIiwiaGVpZ2h0IiwiY2xpZW50SGVpZ2h0Iiwic3JjIiwiYXBwZW5kQ2hpbGQiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlIiwiY2xhc3NOYW1lIiwic2V0QXR0cmlidXRlIiwic21hbGxJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsYXJnZUltYWdlVXJsRm9yUmVzdGF1cmFudCIsInRpdGxlIiwibmFtZSIsImN1aXNpbmVfdHlwZSIsImhlYWRlciIsImZhdm9yaXRlIiwidHlwZSIsImdldEZhdm9yaXRlQ2xhc3MiLCJpc0Zhdm9yaXRlIiwiaXNfZmF2b3JpdGUiLCJyZXN0YXVyYW50SWQiLCJ1cGRhdGVGYXZvcml0ZSIsImFkZHJlc3MiLCJlbXB0eSIsIm1vcmUiLCJocmVmIiwidXJsRm9yUmVzdGF1cmFudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwidXJsIiwicHVzaCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxvQkFBSjtBQUFBLElBQ0NDLHNCQUREO0FBQUEsSUFFQ0MsaUJBRkQ7QUFBQSxJQUdDQyxZQUhEO0FBSUEsSUFBSUMsVUFBVSxLQUFkO0FBQ0EsSUFBSUMsV0FBVyxJQUFmO0FBQ0EsSUFBSUMsVUFBVSxFQUFkOztBQUVBOzs7QUFHQUMsU0FBU0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLFVBQUNDLEtBQUQsRUFBVztBQUN4REM7QUFDQUM7QUFDQSxDQUhEOztBQUtBOzs7QUFHQSxJQUFNRCxxQkFBcUIsU0FBckJBLGtCQUFxQixHQUFNO0FBQ2hDRSxVQUFTRixrQkFBVCxDQUE0QixVQUFDRyxLQUFELEVBQVFaLGFBQVIsRUFBMEI7QUFDckQsTUFBSVksS0FBSixFQUFXO0FBQ1Y7QUFDQUMsV0FBUUQsS0FBUixDQUFjQSxLQUFkO0FBQ0EsR0FIRCxNQUdPO0FBQ05FLFFBQUtkLGFBQUwsR0FBcUJBLGFBQXJCO0FBQ0FlO0FBQ0E7QUFDRCxFQVJEO0FBU0EsQ0FWRDs7QUFZQTs7O0FBR0EsSUFBTUEsd0JBQXdCLFNBQXhCQSxxQkFBd0IsR0FBd0M7QUFBQSxLQUF2Q2YsYUFBdUMsdUVBQXZCYyxL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WSxTQUFULENBQW1CRSxNQUFuQixDQUEwQixxQkFBMUI7QUFDQWQsV0FBU3pELFNBQVQsR0FBcUIsOEJBQXJCO0FBQ0E7QUFDRCxDQVZEOztBQVlBOzs7QUFHQSxJQUFNOEMsa0JBQWtCLFNBQWxCQSxlQUFrQixHQUFvQztBQUFBLEtBQW5DcEUsV0FBbUMsdUVBQXJCZSxLQUFLZixXQUFnQjs7QUFDM0RBLGFBQVltQixPQUFaLENBQW9CLHNCQUFjO0FBQ2pDO0FBQ0EsTUFBTTJFLFNBQVNsRixTQUFTbUYsc0JBQVQsQ0FBZ0N2QyxVQUFoQyxFQUE0Q3pDLEtBQUtaLEdBQWpELENBQWY7QUFDQThDLFNBQU9DLElBQVAsQ0FBWXpDLEtBQVosQ0FBa0J1RixXQUFsQixDQUE4QkYsTUFBOUIsRUFBc0MsT0FBdEMsRUFBK0MsWUFBTTtBQUNwRGxFLFVBQU9xRSxRQUFQLENBQWdCUixJQUFoQixHQUF1QkssT0FBT0ksR0FBOUI7QUFDQSxHQUZEO0FBR0FuRixPQUFLVCxPQUFMLENBQWE2RixJQUFiLENBQWtCTCxNQUFsQjtBQUNBLEVBUEQ7QUFRQSxDQVREIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudHMsXG5cdG5laWdoYm9yaG9vZHMsXG5cdGN1aXNpbmVzLFxuXHRtYXA7XG5sZXQgbGl2ZU1hcCA9IGZhbHNlO1xubGV0IGluaXRMb2FkID0gdHJ1ZTtcbmxldCBtYXJrZXJzID0gW107XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcblx0ZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG5cdGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuXHREQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XG5cdFx0aWYgKGVycm9yKSB7IFxuXHRcdFx0Ly8gR290IGFuIGVycm9yXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcblx0XHRcdGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXHRuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuXHRcdG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5jb25zdCBmZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xuXHREQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgXG5cdFx0XHQvLyBHb3QgYW4gZXJyb3IhXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuXHRcdFx0ZmlsbEN1aXNpbmVzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cblx0Y3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcblx0XHRvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuXHRcdHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG5cdHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59O1xuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuXHRjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXHRjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cblx0Y29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuXHRjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcblx0Y29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG5cdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuXHRcdFx0ZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xuY29uc3QgcmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuXHQvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG5cdHNlbGYucmVzdGF1cmFudHMgPSBbXTtcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuXHR1bC5pbm5lckhUTUwgPSAnJztcblxuXHQvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG5cdHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuXHRzZWxmLm1hcmtlcnMgPSBbXTtcblx0c2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cbi8qIElmIGEgbGl2ZSBtYXAgaXNuJ3QgYWxyZWFkeSBlbmFibGVkLCByZW1vdmVzIHRoZSBzdGF0aWMgbWFwIGltYWdlIGFuZCByZXBsYWNlcyBpdCB3aXRoIGEgbGl2ZSBHb29nbGUgTWFwLiAqL1xuY29uc3QgZ2V0TGl2ZU1hcCA9ICgpID0+IHtcblx0dXBkYXRlUmVzdGF1cmFudHMoKTtcblx0aWYobGl2ZU1hcCl7XG5cdFx0cmV0dXJuO1xuXHR9IGVsc2Uge1xuXHRcdGNvbnN0IHN0YXRpY01hcEltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0aWMtbWFwLWltZycpO1xuXHRcdHN0YXRpY01hcEltZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0YXRpY01hcEltZyk7XG5cdFx0bGV0IGxvYyA9IHtcblx0XHRcdGxhdDogNDAuNzIyMjE2LFxuXHRcdFx0bG5nOiAtNzMuOTg3NTAxXG5cdFx0fTtcblx0XHRzZWxmLm1hcCA9IG5ldyBnb29nbGVcblx0XHRcdC5tYXBzXG5cdFx0XHQuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuXHRcdFx0XHR6b29tOiAxMixcblx0XHRcdFx0Y2VudGVyOiBsb2MsXG5cdFx0XHRcdHNjcm9sbHdoZWVsOiBmYWxzZVxuXHRcdFx0fSk7XG5cdFx0bGl2ZU1hcCA9IHRydWU7XG5cdH1cbn07XG5cbmNvbnN0IGZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcblx0XHR1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuXHR9KTtcblx0XG5cdC8qIExvYWRzIGEgc3RhdGljIG1hcCBpbWFnZSBpZiBpdCdzIHRoZSBpbml0aWFsIHBhZ2UgbG9hZC4gQWRkcyBhIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHNvIHRoYXQgd2hlbiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIG1hcCwgaXQgcmVtb3ZlcyB0aGUgc3RhdGljIG1hcCBpbWFnZSBhbmQgbG9hZHMgYSBsaXZlIG1hcCBpbiBpdHMgcGxhY2UuICovXG5cdGlmIChpbml0TG9hZCl7XG5cdFx0ZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG5cdFx0ZmV0Y2hDdWlzaW5lcygpO1xuXHRcdGNvbnN0IHN0YXRpY01hcCA9IERCSGVscGVyLnN0YXRpY0ltYWdlRm9yTWFwSW5kZXgoc2VsZi5yZXN0YXVyYW50cyk7XG5cdFx0Y29uc3QgbWFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xuXHRcdGNvbnN0IHN0YXRpY01hcEltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRcdHN0YXRpY01hcEltZy5pZCA9ICdzdGF0aWMtbWFwLWltZyc7XG5cdFx0c3RhdGljTWFwSW1nLmFsdCA9ICdTdGF0aWMgR29vZ2xlIE1hcHMgaW1hZ2UnO1xuXHRcdHN0YXRpY01hcEltZy5zdHlsZS53aWR0aCA9IGAke21hcC5jbGllbnRXaWR0aH1weGA7XG5cdFx0c3RhdGljTWFwSW1nLnN0eWxlLmhlaWdodCA9IGAke21hcC5jbGllbnRIZWlnaHR9cHhgO1xuXHRcdHN0YXRpY01hcEltZy5zcmMgPSBzdGF0aWNNYXA7XG5cdFx0c3RhdGljTWFwSW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0Z2V0TGl2ZU1hcCgpO1xuXHRcdH0pO1xuXHRcdG1hcC5hcHBlbmRDaGlsZChzdGF0aWNNYXBJbWcpO1xuXHRcdGluaXRMb2FkID0gZmFsc2U7XG5cdH0gZWxzZSB7XG5cdFx0YWRkTWFya2Vyc1RvTWFwKCk7XG5cdH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuXHQvKiBMYXp5IGxvYWRzIHNtYWxsIG9yIGxhcmdlIHZlcnNpb24gb2YgcmVzdGF1cmFudCBpbWFnZSBiYXNlZCBvbiBkYXRhLXNyY3NldCBhbmQgYXV0byBkYXRhLXNpemVzLiBBbHNvIGR5bmFtaWNhbGx5IHNldHMgYWx0IGFuZCB0aXRsZSB0ZXh0IG9mIHRoZSBpbWFnZS4gKi9cblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOyBcblx0Y29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nIGxhenlsb2FkJztcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIGAke0RCSGVscGVyLnNtYWxsSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA0MDB3YCk7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLGAke0RCSGVscGVyLnNtYWxsSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA0MDB3LCAke0RCSGVscGVyLmxhcmdlSW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfSA4MDB3YCk7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zaXplcycsICdhdXRvJyk7XG5cdGltYWdlLnRpdGxlID0gYCR7cmVzdGF1cmFudC5uYW1lfWA7XG5cdGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0gaW4gJHtyZXN0YXVyYW50Lm5laWdoYm9yaG9vZH0gLSAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSByZXN0YXVyYW50YDtcblx0bGkuYXBwZW5kKGltYWdlKTtcblxuXHQvKiBDcmVhdGVzIGhlYWRlciBkaXYgdG8gaG9sZCBuYW1lICYgZmF2b3JpdGUgYnV0dG9uLiAqL1xuXHRjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0aGVhZGVyLmlkID0gXCJoZWFkZXJcIjtcblx0bGkuYXBwZW5kKGhlYWRlcik7XG5cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXHRoZWFkZXIuYXBwZW5kKG5hbWUpO1xuXG5cdC8qIENyZWF0ZXMgYSBkeW5hbWljIGZhdm9yaXRlIGJ1dHRvbi4gV2hlbiBjbGlja2VkLCBub3RpZmllcyB1c2VyIHRoYXQgcmVzdGF1cmFudCBmYXZvcml0ZSBoYXMgYmVlbiBhZGRlZCBvciByZW1vdmVkIHZpYSB2aXN1YWwgY3VlcyBhbmQgQVJJQSBsYWJlbCBjaGFuZ2VzLiBBbHNvIHVwZGF0ZXMgSURCIHdpdGggZmF2b3JpdGUgc3RhdHVzIG9mIHRoZSByZXN0YXVyYW50LiAqL1xuXHRjb25zdCBmYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRmYXZvcml0ZS50eXBlID0gJ2J1dHRvbic7XG5cdGZhdm9yaXRlLmlkID0gJ2Zhdm9yaXRlLWJ1dHRvbic7XG5cdGZhdm9yaXRlLnRpdGxlID0gJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHRvIGZhdm9yaXRlcycpO1xuXHRnZXRGYXZvcml0ZUNsYXNzKHJlc3RhdXJhbnQsIGZhdm9yaXRlKTtcblx0ZmF2b3JpdGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0bGV0IGlzRmF2b3JpdGU7XG5cdFx0aWYocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ2ZhbHNlJyl7XG5cdFx0XHRpc0Zhdm9yaXRlID0gJ3RydWUnO1xuXHRcdFx0ZmF2b3JpdGUudGl0bGUgPSAnUmVtb3ZlIGZyb20gZmF2b3JpdGVzJztcblx0XHRcdGZhdm9yaXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aXNGYXZvcml0ZSA9ICdmYWxzZSc7XG5cdFx0XHRmYXZvcml0ZS50aXRsZSA9ICdBZGQgdG8gZmF2b3JpdGVzJztcblx0XHRcdGZhdm9yaXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdBZGQgdG8gZmF2b3JpdGVzJyk7XG5cdFx0fVxuXHRcdGNvbnN0IHJlc3RhdXJhbnRJZCA9IHJlc3RhdXJhbnQuaWQ7XG5cdFx0REJIZWxwZXIudXBkYXRlRmF2b3JpdGUocmVzdGF1cmFudElkLCBpc0Zhdm9yaXRlKTtcblx0XHRyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gaXNGYXZvcml0ZTtcblx0XHRnZXRGYXZvcml0ZUNsYXNzKHJlc3RhdXJhbnQsIGZhdm9yaXRlKTtcblx0fSk7XG5cdGhlYWRlci5hcHBlbmQoZmF2b3JpdGUpO1xuXG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0bmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuXHRsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblx0bGkuYXBwZW5kKGFkZHJlc3MpO1xuXG5cdC8qIENyZWF0ZXMgZW1wdHkgZWxlbWVudCBzbyBmbGV4IGdyb3cgY2FuIGJlIGFwcGxpZWQgYW5kIGNyZWF0ZSBzcGFjZSB0byB2ZXJ0aWNhbGx5IGFsaWduIFZpZXcgRGV0YWlscyBidXR0b25zLiAqL1xuXHRjb25zdCBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0ZW1wdHkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtZW1wdHknO1xuXHRsaS5hcHBlbmQoZW1wdHkpO1xuXG5cdGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgUmVzdGF1cmFudCBEZXRhaWxzJztcblx0bW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuXHQvKiBEeW5hbWljYWxseSBzZXRzIHRpdGxlIGF0dHJpYnV0ZS4gKi9cblx0bW9yZS50aXRsZSA9IGAke3Jlc3RhdXJhbnQubmFtZX0gLSBWaWV3IFJlc3RhdXJhbnQgRGV0YWlsc2A7XG5cblx0LyogU2V0cyBBUklBIGF0dHJpYnV0ZXMgdG8gZWFjaCByZXN0YXVyYW50IGxpbmsuICovXG5cdG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xuXHRtb3JlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuXHRtb3JlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdWaWV3JyArIHJlc3RhdXJhbnQubmFtZSArICdSZXN0YXVyYW50IERldGFpbHMnKTtcblx0bGkuYXBwZW5kKG1vcmUpO1xuXG5cdHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQ2hhbmdlIGZhdm9yaXRlIGljb24gdG8gYXBwZWFyIG9uIG9yIG9mZiB3aXRoIGNsYXNzIGNoYW5nZS5cbiAqL1xuY29uc3QgZ2V0RmF2b3JpdGVDbGFzcyA9IChyZXN0YXVyYW50LCBmYXZvcml0ZSkgPT4ge1xuXHRpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnKXtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdpbmRleC1mYXZvcml0ZS10cnVlJyk7XG5cdFx0ZmF2b3JpdGUuY2xhc3NMaXN0LnJlbW92ZSgnaW5kZXgtZmF2b3JpdGUtZmFsc2UnKTtcblx0XHRmYXZvcml0ZS5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYXMgZmEtaGVhcnRcIj48L2k+Jztcblx0fSBlbHNlIHtcblx0XHRmYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdpbmRleC1mYXZvcml0ZS1mYWxzZScpO1xuXHRcdGZhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2luZGV4LWZhdm9yaXRlLXRydWUnKTtcblx0XHRmYXZvcml0ZS5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYXIgZmEtaGVhcnRcIj48L2k+Jztcblx0fVxufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG5cdHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0Ly8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG5cdFx0Y29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XG5cdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmw7XG5cdFx0fSk7XG5cdFx0c2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcblx0fSk7XG59O1xuXG4iXX0=
